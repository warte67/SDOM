<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDOM - Simple SDL Document Object Model: Project Description and Development Progress</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SDOM - Simple SDL Document Object Model
   </div>
   <div id="projectbrief">A lightweight, extensible Document Object Model for SDL-based applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2progress.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Project Description and Development Progress </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md152"></a></p>
<p><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> is a C++23 library built on SDL3 that brings a DOM‑like scene graph and GUI toolkit to 2D applications and games. The aim is a small, predictable core for layout, events, and rendering so SDL developers can compose interfaces and in‑game UI with familiar patterns and a minimal API surface.</p>
<p>Architecturally, a single Core orchestrates the SDL runtime (window, renderer, main loop). A Stage serves as the root of the display tree, while an EventManager dispatches input through capture → target → bubble phases. The Factory registers, creates, and tracks resources and display objects by type and unique name, returning typed handles for safe references. Layout is driven by an edge‑based anchoring system that supports asymmetric, responsive designs.</p>
<p>Scripting and configuration are first‑class with Lua via Sol2 to enable data‑driven scenes, rapid iteration, and test automation. You can also build everything directly in C++—Lua is optional—but when enabled it can construct objects, wire scenes, drive dialog, and swap stages at runtime without recompilation.</p>
<p>The project emphasizes clear, living documentation. The Markdown design docs are working papers that evolve with the code. Expect them to change as features land and APIs are refined. Public APIs are defined in headers and surfaced via Doxygen, with correctness exercised by unit tests; if a doc briefly diverges from current behavior, treat the code as source‑of‑truth until the docs catch up. Diagrams are authored in Mermaid and exported to static SVG/PNG by the repo’s export pipeline, keeping visuals portable while ensuring the sources remain easy to edit. Progress updates will call out notable documentation changes, and contributions to clarify or correct docs are welcome.</p>
<p>This page is the hub for progress. The “Progress Updates” below record milestones chronologically with context and notes; the “Next Steps” and “ToDo” sections outline near‑term priorities and open tracks. Check back to see what landed and what’s coming next—and feel free to open issues or proposals as the API stabilizes.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md153"></a>
Scripting and Configuration</h1>
<p>Lua (via Sol2) is first‑class but optional—you can script scenes and behavior in Lua, build everything in C++, or mix both. The Factory accepts <span class="tt">sol::table</span> configs alongside initializer structs, and Core’s lifecycle hooks make it easy to integrate scripts for iteration and tests. See the dedicated design doc for details and examples: <a class="el" href="md_docs_2scripting__and__configuration.html">Scripting and Configuration (Lua + C++)</a>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md154"></a>
Progress Updates</h1>
<ul>
<li><b>[July 2, 2025]</b> Initial rough draft and proof of concept.</li>
<li><b>[August 5, 2025]</b> <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> secondary rough draft</li>
<li><b>[September 19, 2025]</b><ul>
<li>Proof of concept approved. Main development approved. Work begins officially.</li>
<li>Improved Doxygen documentation for all major headers and macros.</li>
<li>Added and refined Doxygen comments for <a class="el" href="SDOM__CLR_8hpp.html" title="Static container for ANSI escape sequences for terminal text formatting and colorization.">SDOM_CLR.hpp</a>, <a class="el" href="SDOM_8hpp.html">SDOM.hpp</a>, and <a class="el" href="SDOM__IDataObject_8hpp.html">SDOM_IDataObject.hpp</a>.</li>
<li>Grouped and documented interface methods in SDOM_IDataObject for clarity and API usability.</li>
<li>Updated build script to run Doxygen from the correct folder, ensuring documentation builds reliably.</li>
<li>Fixed Doxyfile issues (footer path, PROJECT_BRIEF syntax) for clean documentation generation.</li>
<li>Validated Doxygen output for class, group, and member documentation.</li>
<li><span class="tt">IDataObject</span> designed. This base interface class handles JSON parsing and serialization.</li>
<li>Core class scaffold implemented as a thread-safe singleton.</li>
<li>Core initializes SDL, window, renderer, and texture with correct sizing and color from config.</li>
<li>Window and renderer display with correct logical size and background color.</li>
<li>Configuration via struct, JSON string, and JSON file is working and uses sensible defaults.</li>
<li>Main loop, event polling, and error handling are scaffolded and ready for extension.</li>
<li>Added six callback/hook registration methods to <span class="tt">Core</span>: <span class="tt">registerOnInit()</span>, <span class="tt">registerOnQuit()</span>, <span class="tt">registerOnUpdate()</span>, <span class="tt">registerOnEvent()</span>, <span class="tt">registerOnRender()</span>, <span class="tt">registerOnUnitTest()</span>.</li>
<li>Callbacks are invoked at the appropriate lifecycle and event points, enabling user-defined logic for initialization, quitting, updating, event handling, rendering, and unit testing.</li>
<li>Added <span class="tt">preserveAspectRatio</span> and <span class="tt">allowTextureResize</span> flags to <span class="tt">CoreConfig</span> for flexible window/texture resizing.</li>
<li>Window resizing now supports two modes: aspect ratio preservation and free resizing, controlled by config.</li>
<li>Texture resizing can be disabled via config, allowing fixed-resolution rendering regardless of window size.</li>
<li>JSON configuration supports both new flags for runtime flexibility.</li>
<li>Refined aspect ratio logic to use a static float for original aspect ratio, ensuring accuracy during repeated resizing.</li>
</ul>
</li>
<li><b>[September 20, 2025]</b><ul>
<li>Factory and resource_ptr scaffolding completed; code compiles and runs cleanly.</li>
<li>Event system foundation implemented and documented.</li>
<li>Doxygen documentation added for major interfaces (Core, Factory, IResourceObject).</li>
<li>Example usage of Core and Factory included in documentation.</li>
<li>Circular include and pointer management issues resolved (raw pointer for Factory ownership).</li>
<li>The <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> framework now has a working Core singleton, Factory resource management, and resource_ptr smart handle. The codebase is stable, maintainable, and ready for expanded testing and feature development.</li>
</ul>
</li>
<li><b>[September 21, 2025]</b><ul>
<li>Renamed <span class="tt">resource_ptr</span> to <span class="tt">ResourceHandle</span> throughout the codebase for clarity.<ul>
<li>The new name better reflects its role as an opaque handle or key for resource lookup, rather than a smart pointer with ownership semantics.</li>
<li>Updated all documentation, examples, and comments to use <span class="tt">ResourceHandle</span>.</li>
</ul>
</li>
<li>Factory resource management and <span class="tt">ResourceHandle</span> logic fully tested and confirmed:<ul>
<li>Resources can be added, retrieved, and removed from the Factory.</li>
<li>Multiple <span class="tt">ResourceHandle</span> instances correctly reflect resource existence and become invalid after removal.</li>
<li>Type-safe access via <span class="tt">dynamic_cast</span> is working and robust.</li>
</ul>
</li>
<li>Debug output and test scaffolding added to verify resource lifetime and pointer behavior.</li>
<li>Resolved copy constructor and assignment operator issues for <span class="tt">ResourceHandle</span>.</li>
<li>Confirmed that the Factory now contains a working <span class="tt">Stage</span> resource.</li>
<li>Next step: Implement parent/child relationships for resources and display objects.</li>
<li>Unit test framework will be moved to <span class="tt">onUnitTest()</span> methods once implemented.</li>
<li><b>Resource Creation &amp; Initialization:</b><ul>
<li>Verified that resources (especially Stage) are created via the Factory and properly initialized with onInit().</li>
<li>Debug output confirms lifecycle methods (onInit, onQuit, onUpdate, onRender) are called for the root stage.</li>
</ul>
</li>
<li><b>Core &amp; Factory Integration:</b><ul>
<li>Ensured the root node (mainStage) is set and found by Core, with correct debug output.</li>
<li>Improved resource creation logic to always use Factory::create, guaranteeing initialization and registration.</li>
</ul>
</li>
<li><b>Recursive Traversal:</b><ul>
<li>Implemented and tested recursive lambdas for shutdown (onQuit) and unit testing (onUnitTest), with correct type handling and null checks.</li>
</ul>
</li>
<li><b>Bug Fixes &amp; Stability:</b><ul>
<li>Diagnosed and resolved segmentation faults by adding null checks and debug output.</li>
<li>Tested resource handles and pointer management are more robust and safer, but further testing may be required.</li>
</ul>
</li>
<li><b>Testing &amp; Debugging:</b><ul>
<li>Added debug prints to trace resource creation and lifecycle events.</li>
<li>Validated that the system is ready for expanded DOM tree parsing and more complex resource hierarchies.</li>
</ul>
</li>
</ul>
</li>
<li><b>[September 22, 2025]</b><ul>
<li><b>Unit Test Framework Refined:</b> <br  />
<ul>
<li>Simplified the unit test system: now every resource implements <span class="tt">onUnitTests()</span> for built-in tests.</li>
<li>External/custom unit tests are registered and run via the <span class="tt">registerOnUnitTest()</span> callback, keeping the API minimal and flexible.</li>
<li>Removed unnecessary callback registration logic from <span class="tt">IUnitTest</span>, relying on virtual methods and user callbacks for extensibility.</li>
</ul>
</li>
<li><b>Consistent Naming:</b> <br  />
<ul>
<li>Standardized all unit test-related identifiers to use the plural form (<span class="tt">Tests</span>) for clarity and consistency across the codebase.</li>
</ul>
</li>
<li><b>External Test Integration:</b> <br  />
<ul>
<li>Users no longer need to register callbacks for external unit tests. <br  />
</li>
<li>Instead, external unit test functions (like <span class="tt">Core_UnitTests()</span> and <span class="tt">Factory_UnitTests()</span>) are simply called directly from within the already established <span class="tt">registerOnUnitTest()</span> callback in <span class="tt">main.cpp</span>. <br  />
</li>
<li>This approach makes it straightforward to create and run custom unit tests or build a dedicated test application, while maintaining clear separation between built-in and user-defined tests.</li>
</ul>
</li>
<li><b>API Cleanup:</b> <br  />
<ul>
<li>Removed redundant or overly complex code from the unit test infrastructure.</li>
<li>Ensured the API remains clean, maintainable, and easy to extend.</li>
</ul>
</li>
<li><b>Debugging &amp; Issue Resolution:</b> <br  />
<ul>
<li>Diagnosed and resolved issues with singleton access, reference binding, and infinite recursion in callback registration.</li>
<li>Improved understanding of C++ function pointer and lambda usage for flexible test registration.</li>
</ul>
</li>
<li><b>Expanded Test Coverage:</b> <br  />
<ul>
<li>Added more unit tests for Factory, Stage, and display objects.</li>
<li>Confirmed that the unit test system works well for new features.</li>
<li>Identified the need for a custom test object (e.g., <span class="tt">Box</span>) to facilitate comprehensive anchoring and coordinate propagation tests.</li>
<li>Planned to add live event tests (drag/drop, deferred add/remove) and prioritize tests for new features as they are developed.</li>
<li>Recognized that coverage for older features will be expanded over time, focusing first on the most critical areas.</li>
</ul>
</li>
</ul>
</li>
<li><b>[September 23, 2025]</b><ul>
<li><b>Event System Preliminary Testing:</b> <br  />
<ul>
<li>Successfully integrated and tested the event system with live SDL3 events.</li>
<li>Verified that mouse, keyboard, window, and focus events are received and dispatched correctly.</li>
<li>Confirmed that custom display objects (Box) receive and handle events as expected.</li>
<li>Minimal "life tests" for event propagation and Box object interaction are passing.</li>
<li>Debug output confirms event flow from SDL3 through Core, EventManager, and into display objects.</li>
<li>Refactored event dispatch logic for single-stage architecture, simplifying code and improving maintainability.</li>
<li>Cleaned up circular includes and pointer conversion issues, improving build stability.</li>
<li>Next steps: Expand event tests for Box (drag/drop, stacking, anchoring), add more interactive unit tests, and document event system usage.</li>
<li>Refactored codebase to use new <span class="tt">DomHandle</span> and <span class="tt">ResHandle</span> types throughout.</li>
<li>Verified and debugged handle logic, ensuring safe pointer access and robust operator overloading.</li>
<li>Cleaned up event system: <span class="tt">EventManager</span> now fully leverages the handle system, removing unnecessary casts and improving safety.</li>
<li>Fixed segmentation faults and infinite recursion issues in tree traversal by clarifying handle usage and recursive logic.</li>
<li>Improved code readability and maintainability by removing legacy patterns and redundant checks.</li>
<li>All major event and display object interactions now use the new handle API.</li>
<li>Codebase is stable, with most reference and legacy issues resolved.</li>
</ul>
</li>
</ul>
</li>
<li><b>[September 24, 2025]</b><ul>
<li><b>Event System Debugging:</b><ul>
<li>Resolved compile-time issues with <span class="tt">ListenerEntry</span> constructor and <span class="tt">push_back</span> calls in <span class="tt">addEventListener</span>.</li>
<li>Verified that <span class="tt">addEventListener</span> correctly registers event listeners for both capture and bubbling phases.</li>
<li>Debugged and confirmed proper event propagation through the DOM hierarchy.</li>
<li>Fixed issues with <span class="tt">stopPropagation()</span> and <span class="tt">setPhase()</span> methods, ensuring they work as intended.</li>
<li>Verified that <span class="tt">stopPropagation()</span> halts event propagation during the target phase, skipping the bubbling phase.</li>
</ul>
</li>
<li><b>Box Object Testing:</b><ul>
<li>Tested <span class="tt">Box</span> object interactions with the event system:<ul>
<li>Verified correct output for capture, target, and bubbling phases.</li>
<li>Confirmed that <span class="tt">stopPropagation()</span> prevents bubbling as expected.</li>
</ul>
</li>
<li>Stacked <span class="tt">redBox</span> on <span class="tt">blueBox</span> and <span class="tt">greenBox</span> on <span class="tt">redBox</span> to test event propagation.</li>
<li>Validated event listener behavior for <span class="tt">MouseClick</span> events in all phases. The Box object is not perfect, but it works well enough for testing and serves as a proof of concept for an external application using the <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> API.</li>
</ul>
</li>
<li><b>Code Cleanup:</b><ul>
<li>Removed debug logs and redundant code from <span class="tt">addEventListener</span> and <span class="tt">triggerEventListeners</span>.</li>
<li>Simplified event listener registration and dispatch logic.</li>
</ul>
</li>
<li><b>Milestone:</b> Event System Stability<ul>
<li>After extensive debugging and testing, the <span class="tt">EventManager</span>, <span class="tt">EventListeners</span>, and overall event system are now stable and behave according to typical DOM specifications.</li>
<li>Both instant and deferred <span class="tt">addChild()</span> and <span class="tt">removeChild()</span> operations work reliably, ensuring robust event propagation and hierarchy management.</li>
<li>With the event system confirmed stable, we’ve decided this is the ideal time to begin transitioning from <span class="tt">JSON-based</span> initialization to <span class="tt">Sol2-powered Lua</span> scripting.</li>
</ul>
</li>
</ul>
</li>
<li><b>[September 25, 2025]</b><ul>
<li><b>JSON → Lua Transition Complete:</b> <br  />
<ul>
<li>All configuration, scripting, and resource creation now use Lua tables via Sol2.</li>
<li>Factory, Core, and EventManager refactored to accept and process <span class="tt">sol::table</span> configs.</li>
<li>All display object constructors updated to support Lua-based initialization.</li>
<li>Removed legacy JSON code paths and tests.</li>
</ul>
</li>
<li><b>Unit Tests Passing:</b> <br  />
<ul>
<li>All core, factory, display object, and stage unit tests now pass with Lua configs.</li>
<li>Verified resource creation, retrieval, type checking, and destruction using Lua.</li>
<li>Event system and Box object tests run successfully with Lua-driven scenes.</li>
</ul>
</li>
<li><b>Robust Numeric Handling:</b> <br  />
<ul>
<li>Fixed Sol2 numeric type issues by casting Lua numbers to C++ types as needed.</li>
<li>Optional properties (<span class="tt">x</span>, <span class="tt">y</span>, <span class="tt">width</span>, <span class="tt">height</span>) now default sensibly if missing.</li>
</ul>
</li>
<li><b>Improved Type Assignment:</b> <br  />
<ul>
<li>All display objects correctly assign and report their type from Lua configs.</li>
<li>Resource handles and type checks now work as expected.</li>
</ul>
</li>
<li><b>Documentation and API Consistency:</b> <br  />
<ul>
<li>Updated documentation to reflect Lua-first configuration and scripting.</li>
<li>All examples and tests now use Lua for initialization and setup.</li>
</ul>
</li>
<li><b>Milestone:</b> <br  />
<ul>
<li><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> is now fully Lua-configurable and ready for advanced scripting, rapid prototyping, and integration with external tools. Json features have been removed completely.</li>
</ul>
</li>
</ul>
</li>
<li><b>[September 26, 2025]</b></li>
<li><b>Box Unit Tests Complete:</b> <br  />
<ul>
<li>Finalized comprehensive unit tests for the Box object, covering creation, hierarchy, anchor logic, and world coordinate propagation.</li>
<li>All anchor setters and edge references are tested for all anchor points and hierarchy levels.</li>
<li>Confirmed that the Box object works as a reliable proof of concept for external applications using the <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> API.</li>
<li>Decided to defer exhaustive reference calculation tests for resizing and complex anchor scenarios until a specific layout issue is identified.</li>
<li>The Box unit test suite is now robust and maintainable; targeted tests will be added as new bugs or features arise.</li>
</ul>
</li>
<li><b>Orphaned Display Object Management:</b> <br  />
<ul>
<li>Implemented <span class="tt">Factory::countOrphanedDisplayObjects()</span>, <span class="tt">getOrphanedDisplayObjects()</span>, and <span class="tt">destroyOrphanedDisplayObjects()</span> for robust orphan detection and cleanup.</li>
<li>Improved <span class="tt">destroyOrphanedDisplayObjects()</span> to recursively remove all orphaned objects, including nested orphans, ensuring a clean DOM state after parent removal.</li>
<li>Added unit tests to verify orphan detection and recursive cleanup logic.</li>
<li>Documented the current behavior and discussed future enhancements for selective orphan preservation.</li>
<li>Proposed an <span class="tt">OrphanCleanupPolicy</span> enum for <span class="tt">IDisplayObject</span> to allow marking objects as persistent, templates, or editor-only, enabling fine-grained control over orphan cleanup (feature deferred for future implementation).</li>
</ul>
</li>
<li><b>General Stability:</b> <br  />
<ul>
<li>All core, factory, display object, and stage unit tests are passing.</li>
<li>Event system and Lua-driven configuration are stable and fully integrated.</li>
<li>Documentation and codebase are up-to-date with recent changes.</li>
</ul>
</li>
<li><b>[September 27, 2025]</b><ul>
<li><b>Lua Integration Complete:</b> <br  />
<ul>
<li>All major Core and Factory methods are now exposed to Lua via Sol2 usertype registration.</li>
<li>Overloaded methods and custom types (DomHandle, SDL_Color) are correctly bound and accessible from Lua scripts.</li>
<li>The Lua API is stable, with all required commands available for scripting, configuration, and test automation.</li>
</ul>
</li>
<li><b>Lua/C++ Unit Test Integration Enhanced:</b> <br  />
<ul>
<li>Refined Lua-driven unit tests for display object creation, stage hierarchy, and destruction.</li>
<li>Confirmed that DomHandles automatically become invalid (<span class="tt">nullptr</span>) when their resource is destroyed in the Factory, ensuring safe reference semantics.</li>
<li>Improved <span class="tt">IDisplayObject::hasChild()</span> logic to check both handle presence and validity, preventing false positives when objects are deleted.</li>
<li>All current unit tests now pass, including tests for creation, addition to stage, and destruction/removal verification.</li>
<li>Added Lua-side debugging utilities: Factory registry and stage tree can be printed directly from Lua scripts for live inspection.</li>
<li>Demonstrated robust C++/Lua test integration: Lua scripts return boolean results to C++ test framework, enabling seamless cross-language validation.</li>
<li>Codebase and Lua API stability increased, with reliable resource management and hierarchy checks.</li>
</ul>
</li>
</ul>
</li>
<li><b>[September 28, 2025]</b><ul>
<li><b>Lua Binding Improvements:</b><ul>
<li>Refined Lua usertype registration to ensure idempotent and consistent bindings.</li>
<li>Verified that all properties, commands, and functions are correctly exposed to Lua for Core, Factory, DomHandle, and IDisplayObject.</li>
<li>Added missing getters (<span class="tt">getX</span>, <span class="tt">getY</span>, <span class="tt">getWidth</span>, <span class="tt">getHeight</span>) to DomHandle Lua bindings.</li>
<li>Ensured that overloaded methods are properly handled in Lua.</li>
<li>Centralized Lua bindings: Factory now maintains a registry (<span class="tt">registerLuaProperty</span> / <span class="tt">registerLuaCommand</span> / <span class="tt">registerLuaFunction</span>) and applies entries idempotently in a two‑phase process (create minimal sol2 usertype, then attach registry entries).</li>
<li>Lua API &amp; binding fixes: <span class="tt">DomHandle</span> and <span class="tt">Core</span> bindings improved (correct boxing/forwarding, colon-call signatures); EventType constants exposed; Sol2 runtime issues (nil-call/userdata mismatches) resolved.</li>
<li>Test helpers: added <span class="tt">Core:pushMouseEvent({x,y,type,button})</span> and <span class="tt">Core:pumpEventsOnce()</span> so Lua can synthesize and dispatch SDL events deterministically.</li>
<li>DomHandle Lua conveniences: <span class="tt">addEventListener</span> forwarding and simple getters (<span class="tt">getX</span>/<span class="tt">getY</span>/<span class="tt">getWidth</span>/<span class="tt">getHeight</span>) exposed to Lua.</li>
<li>Box test scaffolding: added simple Box functions (doSomething, resetColor) and a click counter used by synthetic-event tests.</li>
<li>Lua-driven tests added/updated:<ul>
<li>test5: getPropertyNamesForType("blueishBox")</li>
<li>test6: getFunctionNamesForType("blueishBox")</li>
<li>test7: getCommandNamesForType("blueishBox")</li>
<li>test8: C++-synthesized MouseClick → Box listener</li>
<li>test9: Lua-only listener + synthetic click (restores keyboard focus to Stage)</li>
</ul>
</li>
<li>Cleanup: removed temporary debug instrumentation and test-only Factory helpers.</li>
<li>Status: All core C++ unit tests and Lua-driven tests pass locally.</li>
</ul>
</li>
<li><b>Event System Enhancements:</b><ul>
<li>Improved synthetic event handling in Lua with <span class="tt">Core:pushMouseEvent()</span> and <span class="tt">Core:pumpEventsOnce()</span>.</li>
<li>Verified that synthetic events correctly trigger event listeners on display objects.</li>
</ul>
</li>
<li><b>Box Object Enhancements:</b><ul>
<li>Added utility functions to Box for testing purposes (e.g., <span class="tt">doSomething</span>, <span class="tt">resetColor</span>).</li>
<li>Implemented a click counter to track interactions during tests.</li>
</ul>
</li>
<li><b>Unit Test Expansion:</b><ul>
<li>Added new Lua-driven unit tests to cover property, command, and function retrieval for custom display objects.</li>
<li>Verified that all existing tests pass successfully with the latest Lua bindings.</li>
</ul>
</li>
<li><b>Code Cleanup:</b><ul>
<li>Removed temporary debug instrumentation and test-only Factory helpers.</li>
<li>Ensured the codebase is clean and maintainable.</li>
</ul>
</li>
</ul>
</li>
<li><b>[September 29, 2025]</b><ul>
<li><b>Lua Binding Debugging:</b><ul>
<li>Added controlled debug prints to Lua usertype registration to trace binding operations.</li>
<li>Verified that each usertype (DomHandle, IDisplayObject, Stage, Factory, Core) is registered exactly once, preventing conflicts and ensuring consistent behavior.</li>
<li>Debug prints can be toggled with the <span class="tt">DEBUG_REGISTER_LUA</span> constant in <span class="tt"><a class="el" href="SDOM_8hpp.html">SDOM.hpp</a></span>.</li>
</ul>
</li>
<li><b>Binding Consistency:</b><ul>
<li>Ensured that all Lua bindings are idempotent and do not conflict with each other.</li>
<li>Verified that overloaded methods and custom types are correctly handled in Lua.</li>
</ul>
</li>
<li><b>Code Cleanup:</b><ul>
<li>Removed unnecessary debug prints from production code, leaving controlled logging for future debugging needs.</li>
<li>Ensured the codebase remains clean and maintainable.</li>
</ul>
</li>
<li><b>Core Lua Wrappers Verified:</b><ul>
<li>Completed verification of Core/Factory Lua wrapper coverage (get/set window title, event helpers, DomHandle forwards, focus/hover helpers, object lookup, and orphan management commands exposed to Lua).</li>
<li>Added <span class="tt">test20_lua</span> which validates <span class="tt">Core:getWindowTitle()</span> and <span class="tt">Core:setWindowTitle()</span> round-trip behavior; the <span class="tt">examples/test/prog</span> test binary builds and runs with the new test.</li>
<li>As requested, the <span class="tt">clearFactory</span> Lua binding was removed (it can be reintroduced later if needed).</li>
</ul>
</li>
<li><b>Lua Bounds / DomHandle updates (today):</b><ul>
<li>Exposed a typed <span class="tt">Bounds</span> userdata to Lua (fields: <span class="tt">left/top/right/bottom</span>, integer/float helpers) and added method-style getters (<span class="tt">getLeft</span>/<span class="tt">getTop</span>/<span class="tt">getRight</span>/<span class="tt">getBottom</span>/<span class="tt">getX</span>/<span class="tt">getY</span>/<span class="tt">getWidth</span>/<span class="tt">getHeight</span>) plus an epsilon-aware helper <span class="tt">almostEqual(a,b,eps?)</span> for robust comparisons.</li>
<li>Synchronized <span class="tt">Bounds</span> registrations so both <span class="tt">DomHandle</span> and <span class="tt">IDisplayObject</span> present a consistent Lua API.</li>
<li>Added/updated DomHandle forwards so Lua can call <span class="tt">h:getBounds()</span> (returns <span class="tt">Bounds</span> userdata) and <span class="tt">h:setBounds({...})</span> (accepts a Lua table), and added edge getters (<span class="tt">getLeft</span>/<span class="tt">getTop</span>/<span class="tt">getRight</span>/<span class="tt">getBottom</span>) on the handle.</li>
<li>Reworked the IDisplayObject unit tests: made <span class="tt">test10</span> a Lua-only bounds comparison and added <span class="tt">test11</span> to drive <span class="tt">setBounds</span> from Lua and verify <span class="tt">getX</span>/<span class="tt">getY</span>/<span class="tt">getWidth</span>/<span class="tt">getHeight</span> and edge getters.</li>
<li>Verified the change by building (<span class="tt">./compile</span>) and running the test binary (<span class="tt">./prog</span>); all unit tests passed locally.</li>
</ul>
</li>
<li><b>Lua wrapper headers verified:</b><ul>
<li>Both primary bulk Lua wrapper headers, <span class="tt"><a class="el" href="lua__Core_8hpp.html">lua_Core.hpp</a></span> and <span class="tt"><a class="el" href="lua__IDisplayObject_8hpp.html">lua_IDisplayObject.hpp</a></span>, have complete implementations and are exercised by the <span class="tt">examples/test</span> Lua unit tests. The test run (<span class="tt">./compile clean &amp;&amp; ./prog</span>) confirms Lua-level coverage for creation, property access, event helpers, DomHandle forwards, anchors/edges, geometry, and factory helpers.</li>
<li>Temporary debug prints used during binding debugging were cleaned up; controlled registration logging remains toggleable via <span class="tt">DEBUG_REGISTER_LUA</span> in <span class="tt"><a class="el" href="SDOM_8hpp.html">SDOM.hpp</a></span>.</li>
</ul>
</li>
<li><b>DomHandle_UnitTests:</b> DomHandle_UnitTests now contains:<ul>
<li>A concise numeric mapping header above the DomHandle tests.</li>
<li>Full human-readable descriptions (matching the strings passed to UnitTests::run) in place of the short mapping comments.</li>
<li>Test functions renamed to DomHandle_test1 … DomHandle_test10.</li>
<li>The tests vector updated to call the new functions and includes matching descriptive comments.</li>
<li>Debug output updated to reference DomHandle_test10 where applicable.</li>
<li>A clean build and test run were executed successfully. <br  />
</li>
<li>Reworked the DomHandle unit tests for readability and maintainability: added a numeric mapping header, expanded inline descriptions to match <span class="tt">UnitTests::run</span> strings, and renamed test functions to <span class="tt">DomHandle_test1</span>..<span class="tt">DomHandle_test10</span>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><b>[September 30, 2025]</b> <b>Lua Binding Debugging:</b></p><ul>
<li>Added controlled debug prints to Lua usertype registration to trace binding operations.</li>
<li>Verified that each usertype (DomHandle, IDisplayObject, Stage, Factory, Core) is registered exactly once, preventing conflicts and ensuring consistent behavior.</li>
<li>Debug prints can be toggled with the <span class="tt">DEBUG_REGISTER_LUA</span> constant in <span class="tt"><a class="el" href="SDOM_8hpp.html">SDOM.hpp</a></span>. <b>Binding Consistency:</b></li>
<li>Ensured that all Lua bindings are idempotent and do not conflict with each other.</li>
<li>Verified that overloaded methods and custom types are correctly handled in Lua. <b>Code Cleanup:</b></li>
<li>Removed unnecessary debug prints from production code, leaving controlled logging for future debugging needs.</li>
<li>Ensured the codebase remains clean and maintainable. <b>Runtime wrappers &amp; module support:</b></li>
<li>Added Lua runtime wrappers so the embedded Core can execute scripts directly from Lua: <span class="tt">core.run()</span> now accepts either a raw Lua string to execute or a filename to load and run.</li>
<li>Enabled module-style scripting by opening <span class="tt">package</span>/<span class="tt">io</span> in the embedded state and preferring module-style configs (modules that return a table). This makes <span class="tt">require</span>-based configs and modular callback files work naturally in the embedded environment. <b>Core runtime wrappers &amp; module support:</b></li>
<li>Added <span class="tt">Core:run()</span> (exposed to Lua as <span class="tt">core.run</span>) which accepts either a Lua string or a filename and executes it in the embedded state, enabling runtime script execution and quick iteration.</li>
<li>Enabled module-style scripting by opening <span class="tt">package</span>/<span class="tt">io</span> in the embedded Lua state and preferring modules that return a table; this allows <span class="tt">require</span>-based configs and modular callback files. <b>Event / DisplayObject hooks (note):</b> <b><a class="el" href="classCLR.html" title="Static container for ANSI escape sequences and formatting helpers.">CLR</a> / Terminal &amp; Debug Text:</b></li>
<li>Implemented fast terminal helpers in <a class="el" href="classCLR.html" title="Static container for ANSI escape sequences and formatting helpers.">CLR</a> (ANSI save/restore and <a class="el" href="classCLR.html#a9a5487e769cddf9b64e80394f8f74bea" title="Fast helper to write a string at a given terminal position.">CLR.write_at</a>) to avoid expensive /dev/tty cursor-position queries and per-frame blocking.</li>
<li>Exposed <a class="el" href="classCLR.html#a9a5487e769cddf9b64e80394f8f74bea" title="Fast helper to write a string at a given terminal position.">CLR.write_at</a> and <a class="el" href="classCLR.html#a81d0c25043e13d8292c35d6ed151b291">CLR.draw_debug_text</a> to Lua so scripts can render debug overlays or FPS efficiently.</li>
<li>Switched draw_debug_text to use SDL3's SDL_RenderDebugText as the primary in-window renderer and documented fallback options for terminals without support.</li>
<li>Outcome: debug text and FPS overlays update at frame rate with minimal overhead, improving responsiveness and eliminating terminal read latency.</li>
<li>Added EventType entries for IDisplayObject virtual hooks (Update, Render) so stage/display-object listeners can be registered consistently.</li>
<li>TODO (left as a note for next shift): wire the dispatch points so these EventTypes are emitted from the IDisplayObject update/render traversal at the correct phases (target/capture/bubble as appropriate). Until dispatched, user Render/Update listeners should be attached via the stage or Core-level callbacks.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md155"></a>
Next Steps (garbage collection / orphan retention)</h1>
<p>Proposed approach: add an <span class="tt">OrphanRetentionPolicy</span> enum (or a smaller <span class="tt">retainOnOrphan</span> boolean for a quick win) on <span class="tt">IDisplayObject</span> and make the Factory's orphan collector respect each object's policy. This supports editor/templates that should not be destroyed immediately and gives a clear migration path to more sophisticated GC.</p>
<p>Recommended enum (suggested values):</p><ul>
<li><span class="tt">OrphanRetentionPolicy::AutoDestroy</span> — object is eligible for destruction immediately when orphaned. (fast, default for ephemeral runtime objects)</li>
<li><span class="tt">OrphanRetentionPolicy::GracePeriod</span> — object is eligible only after a configurable grace period has elapsed since it became orphaned; allows reparenting via DomHandle within the grace window.</li>
<li><span class="tt">OrphanRetentionPolicy::RetainUntilManual</span> — object is never auto-destroyed; requires explicit Factory or user code to destroy. (useful for editor templates and long-lived resources)</li>
<li><span class="tt">OrphanRetentionPolicy::RetainWhenReferenced</span> — object is retained while any DomHandle or external reference exists; destroyed only once all references are gone and policy conditions met. (optional advanced mode)</li>
</ul>
<p>Minimal API hints:</p><ul>
<li>in <span class="tt">IDisplayObject</span>: add <span class="tt">OrphanRetentionPolicy orphanPolicy = OrphanRetentionPolicy::GracePeriod;</span> and <span class="tt">std::chrono::milliseconds orphanGrace{5000};</span></li>
<li>convenience setters/getters: <span class="tt">setOrphanPolicy(...)</span>, <span class="tt">getOrphanPolicy()</span>, <span class="tt">setOrphanGrace(...)</span></li>
<li>in the Factory: track an <span class="tt">optional&lt;steady_clock::time_point&gt; orphanedAt</span> per object and implement <span class="tt">collectOrphans()</span> which checks policy+elapsed time and destroys accordingly.</li>
</ul>
<p>Notes &amp; test ideas:</p><ul>
<li>Reparent before grace expiry should clear <span class="tt">orphanedAt</span> and prevent destruction.</li>
<li><span class="tt">RetainUntilManual</span> objects should be visible in <span class="tt">Factory::listOrphanedObjects()</span> and only removed by explicit destroy.</li>
<li>Add unit tests for each policy (auto destroy, grace window reparenting, retained objects resisting collection).</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md156"></a>
ToDo:</h1>
<ul>
<li>Expand Lua examples and add more regression tests (invalid/nil handles, wrong-typed args, double-add/remove edge cases).</li>
<li>Expand Lua scripting examples and documentation.</li>
<li>Continue improving resource management and garbage collection.</li>
<li>Plan for future language hooks (e.g., Python).</li>
<li>Maintain and update Doxygen and Markdown docs as features evolve.</li>
<li>Implement garbage_collection() for display objects.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md157"></a>
Current repo/test state (summary)</h2>
<p>DomHandle_UnitTests.cpp now contains:</p><ul>
<li>A concise numeric mapping header above the DomHandle tests.</li>
<li>Full human-readable descriptions (matching the strings passed to UnitTests::run) in place of the short mapping comments.</li>
<li>Test functions renamed to DomHandle_test1 … DomHandle_test10.</li>
<li>The tests vector updated to call the new functions and includes matching descriptive comments.</li>
<li>Debug output updated to reference DomHandle_test10 where applicable.</li>
<li>A clean build and test run were executed successfully. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<footer>
  <a href="https://github.com/warte67/SDOM">Back to SDOM on GitHub</a>
</footer>
