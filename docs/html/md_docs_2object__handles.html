<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDOM - Simple SDL Document Object Model: Object Handles in SDOM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SDOM - Simple SDL Document Object Model
   </div>
   <div id="projectbrief">A lightweight, extensible Document Object Model for SDL-based applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2object__handles.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Object Handles in SDOM </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md320"></a></p>
<table class="doxtable">
<tr>
<td style="width: 200px; vertical-align: top;"><img src="diagrams/artwork/two-trees.png" alt="Two trees representing SDOM's two distinct trees" style="max-width: 200px; border-radius: 4px;" class="inline"/> </td><td style="vertical-align: top; padding-left: 12px;">Like two trees in a garden—one bearing the leaves and branches you can see, and one with roots that quietly nourish—SDOM separates concerns into two living structures. The <b>visual tree</b> is composed of <code>IDisplayObject</code> nodes that form the interactive scene: they receive events, participate in layout and anchoring, and render to the screen. In parallel, the <b>asset tree</b> is composed of <code>IAssetObject</code> nodes that hold images, fonts, audio, and configuration—everything the visuals consume, but which is not itself part of the scene graph. <code>DisplayHandle</code> safely references nodes in the visual tree, while <code>AssetHandle</code> safely references assets in the asset tree, preventing accidental cross-use and eliminating dangling references. Keeping these trees distinct avoids “grafted” diamond-inheritance pathologies, clarifies lifecycles and traversal, and keeps ownership predictable as your application grows. </td></tr>
</table>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md322"></a>
Two Trees in the Garden</h1>
<div class="fragment"><div class="line">flowchart TB</div>
<div class="line">    classDef dom fill:#eef7ff,stroke:#4a90e2,color:#1a3b5d,stroke-width:1px</div>
<div class="line">    classDef res fill:#fff8e6,stroke:#f0ad4e,color:#5a4500,stroke-width:1px</div>
<div class="line">    classDef handle fill:#f7fff0,stroke:#7bb661,color:#234d20,stroke-width:1px</div>
<div class="line"> </div>
<div class="line">    %% Top center: generic handle concept (&quot;Garden&quot;)</div>
<div class="line">    Garden[&quot;Handle&amp;lt;T&amp;gt;&lt;br/&gt;Garden&quot;]:::handle</div>
<div class="line"> </div>
<div class="line">    %% Left stack: AssetHandle above Asset tree</div>
<div class="line">    subgraph RES[&quot;Asset Tree (assets)&quot;]</div>
<div class="line">        direction TB</div>
<div class="line">        ResHandle[&quot;AssetHandle&quot;]:::handle</div>
<div class="line">        RRoot[&quot;Assets (root)&quot;]:::res</div>
<div class="line">        Img[&quot;Image: logo.png&quot;]:::res</div>
<div class="line">        Font[&quot;Font: Roboto.ttf&quot;]:::res</div>
<div class="line">        RRoot --&gt; Img</div>
<div class="line">        RRoot --&gt; Font</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    %% Right stack: DisplayHandle above DOM tree</div>
<div class="line">    subgraph DOM[&quot;Display Tree (visual)&quot;]</div>
<div class="line">        direction TB</div>
<div class="line">        DomHandle[&quot;DisplayHandle&quot;]:::handle</div>
<div class="line">        Stage[&quot;Stage (root)&quot;]:::dom</div>
<div class="line">        Btn[&quot;Button&quot;]:::dom</div>
<div class="line">        Panel[&quot;Panel&quot;]:::dom</div>
<div class="line">        Stage --&gt; Btn</div>
<div class="line">        Stage --&gt; Panel</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    %% Connections from Garden</div>
<div class="line">    Garden --&gt; ResHandle</div>
<div class="line">    Garden --&gt; DomHandle</div>
</div><!-- fragment --><p>Why two trees</p><ul>
<li>Clear separation of UI logic vs. asset management.</li>
<li>Independent lifecycles and traversal patterns.</li>
<li>Type-safe handles (<span class="tt">DisplayHandle</span>, <span class="tt">AssetHandle</span>) prevent accidental mixing.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md323"></a>
Overview</h1>
<p>In <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a>, a handle is a small, typed, value object that identifies something by name and type, then resolves it on demand through the Factory. <span class="tt">DisplayHandle</span> refers to nodes in the visual tree (<span class="tt">IDisplayObject</span>), while <span class="tt">AssetHandle</span> points to assets in the asset tree (<span class="tt">IAssetObject</span>). Each handle carries only two strings (name and type), making it cheap to copy, easy to compare, and safe to pass across boundaries (e.g., Lua scripts, configs, or tooling).</p>
<p>Resolution is lazy: when you call <span class="tt">get()</span>, dereference (<span class="tt">-&gt;</span>/<span class="tt">*</span>), or convert to <span class="tt">bool</span>, the handle consults the Factory’s registry to fetch the current live object for that name/type. This indirection cleanly decouples the producer of a reference from the owner of the object. As long as the Factory keeps its name→pointer map up to date, existing handles remain valid even if objects are recreated or resources are reloaded behind the scenes. Conversely, a missing or stale entry simply yields a null handle (<span class="tt">!handle</span>), which you can detect via <span class="tt">isValid()</span>.</p>
<p>Handles are first-class participants throughout the API. Events carry <span class="tt">DisplayHandle</span> for their <span class="tt">target</span>, <span class="tt">currentTarget</span>, and <span class="tt">relatedTarget</span>, which makes them easy to log (name/type) without leaking raw pointers. UI code can store <span class="tt">DisplayHandle</span> for parent/child relationships or late-bound lookups, while systems that need assets (images, fonts, audio, configuration) use <span class="tt">AssetHandle</span> to request them from the asset tree. The split between <span class="tt">DisplayHandle</span> and <span class="tt">AssetHandle</span> enforces at the type level that display logic never “accidentally” treats an asset like a DOM node (and vice versa), preserving the integrity of the two-tree design.</p>
<p>Key properties at a glance:</p><ul>
<li>Type-safe: <span class="tt">DisplayHandle</span> and <span class="tt">AssetHandle</span> are distinct types, preventing cross-tree misuse.</li>
<li>Lightweight: stores name/type strings; copyable, comparable, and nullable.</li>
<li>Portable: ideal for events, persistence, and tooling; you can reconstruct a handle from name/type in your preferred scripting/config system.</li>
<li>Stable by indirection: resolution goes through the Factory so ownership and lifetimes stay centralized.</li>
<li>Practical null semantics: missing entries resolve to null; check with <span class="tt">isValid()</span> or <span class="tt">if (handle)</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md324"></a>
Handle Types</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md325"></a>
1. DisplayHandle</h2>
<ul>
<li><b>Purpose:</b> References DOM objects (display objects) in the scene graph.</li>
<li><b>Underlying Type:</b> Points to <span class="tt">IDisplayObject</span>.</li>
<li><b>Usage:</b> Used for event targets, parent/child relationships, and DOM traversal.</li>
<li><b>Benefits:</b> Type-safe access to display object members without casting.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md326"></a>
2. AssetHandle</h2>
<ul>
<li><b>Purpose:</b> References file-based assets (bitmaps, sounds, fonts, etc.).</li>
<li><b>Underlying Type:</b> Points to <span class="tt">IAssetObject</span>.</li>
<li><b>Usage:</b> Used for asset management, loading, and access.</li>
<li><b>Benefits:</b> Keeps asset logic separate from DOM logic.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md327"></a>
Design Rationale</h1>
<ul>
<li><b>Separation of Concerns:</b> DOM objects and resources have different lifecycles and usage patterns.</li>
<li><b>Type Safety:</b> Prevents accidental mixing of handles and objects.</li>
<li><b>Clarity:</b> Code is easier to read and maintain.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md329"></a>
Inheritance Warning: Avoid Diamond Inheritance</h1>
<div class="fragment"><div class="line">%%{init: {&quot;flowchart&quot;: { &quot;rankSpacing&quot;: 40, &quot;nodeSpacing&quot;: 140 }}}%%</div>
<div class="line">flowchart TB</div>
<div class="line">        classDef base fill:#eef7ff,stroke:#4a90e2,color:#1a3b5d,stroke-width:1px</div>
<div class="line">        classDef bad  fill:#ffecec,stroke:#e57373,color:#8a1f1f,stroke-width:1px</div>
<div class="line">        classDef handle fill:#f7fff0,stroke:#7bb661,color:#234d20,stroke-width:1px</div>
<div class="line"> </div>
<div class="line">        %% Top row</div>
<div class="line">        subgraph TOP[&quot; &quot;]</div>
<div class="line">            direction TB</div>
<div class="line">            IDO[&quot;IDisplayObject&quot;]:::base</div>
<div class="line">        end</div>
<div class="line"> </div>
<div class="line">        %% Middle row (left-to-right): Garden -&gt; Bad</div>
<div class="line">        subgraph MID[&quot; &quot;]</div>
<div class="line">            direction LR</div>
<div class="line">            Garden[&quot;Handle&amp;lt;T&amp;gt;&lt;br/&gt;Garden&quot;]:::handle</div>
<div class="line">            Bad[&quot;BadThing&lt;br/&gt;(inherits both)&quot;]:::bad</div>
<div class="line">        end</div>
<div class="line"> </div>
<div class="line">        %% Bottom row</div>
<div class="line">        subgraph BOTTOM[&quot; &quot;]</div>
<div class="line">            direction TB</div>
<div class="line">            IRO[&quot;IAssetObject&quot;]:::base</div>
<div class="line">        end</div>
<div class="line"> </div>
<div class="line">        %% Dotted relation lines from Garden (context, not inheritance)</div>
<div class="line">        Garden -. related .- IDO</div>
<div class="line">        Garden -. related .- IRO</div>
<div class="line"> </div>
<div class="line">        %% Inheritance edges (top/bottom to middle-right)</div>
<div class="line">        IDO --&gt; Bad</div>
<div class="line">        IRO --&gt; Bad</div>
</div><!-- fragment --><p>Best practice</p><ul>
<li>Do not inherit from both <span class="tt">IDisplayObject</span> and <span class="tt">IAssetObject</span> in the same class.</li>
<li>Keep types clearly in one tree or the other to avoid ambiguity and subtle bugs.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md330"></a>
Example Usage</h1>
<div class="fragment"><div class="line">DisplayHandle buttonHandle = factory.getDisplayHandle(<span class="stringliteral">&quot;Button1&quot;</span>);</div>
<div class="line">IDisplayObject* button = buttonHandle.get();</div>
<div class="line"> </div>
<div class="line">AssetHandle imageHandle = factory.getAssetHandle(<span class="stringliteral">&quot;LogoImage&quot;</span>);</div>
<div class="line">IAssetObject* image = imageHandle.get();</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md331"></a>
Migration Strategy</h1>
<p>&ndash; Refactor all existing <span class="tt">ResourceHandle</span> usages for display objects to <span class="tt">DisplayHandle</span>. &ndash; Introduce <span class="tt">AssetHandle</span> for new asset types. &ndash; Update Factory and registry to support both handle types.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md332"></a>
Best Practices</h1>
<ul>
<li>Always use the appropriate handle type for the object/resource.</li>
<li>Do not expose public mutators for critical relationships (e.g., parent/child in DOM).</li>
<li>Use provided methods for tree and resource manipulation.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md334"></a>
Optional: Handle Resolution Flow (reference)</h1>
<div class="fragment"><div class="line"> -norender</div>
<div class="line">flowchart LR</div>
<div class="line">    classDef core fill:#f5f5f5,stroke:#999,color:#333,stroke-width:1px</div>
<div class="line">    classDef dom  fill:#eef7ff,stroke:#4a90e2,color:#1a3b5d,stroke-width:1px</div>
<div class="line">    classDef handle fill:#f7fff0,stroke:#7bb661,color:#234d20,stroke-width:1px</div>
<div class="line"> </div>
<div class="line">    Factory[&quot;Factory registry: name-&gt;ptr&quot;]:::core</div>
<div class="line">    H[&quot;DisplayHandle (name)&quot;]:::handle</div>
<div class="line">    Obj[&quot;IDisplayObject&quot;]:::dom</div>
<div class="line"> </div>
<div class="line">    H -. lookup by name .-&gt; Factory</div>
<div class="line">    Factory --&gt; Obj</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<footer>
  <a href="#top">Back to top</a> &nbsp;|&nbsp; <a href="https://github.com/warte67/SDOM">Back to SDOM on GitHub</a>
</footer>
<script type="module">
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ startOnLoad: true, theme: "neutral" });
</script>
