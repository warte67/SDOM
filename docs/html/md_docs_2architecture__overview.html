<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDOM - Simple SDL Document Object Model: Architecture Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SDOM - Simple SDL Document Object Model
   </div>
   <div id="projectbrief">A lightweight, extensible Document Object Model for SDL-based applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2architecture__overview.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Architecture Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<p><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> is a lightweight C++ runtime and display framework built around a clear separation of concerns: <b>display objects</b> (the scene graph) and <b>asset objects</b> (resources such as images, fonts, audio, etc.). Application code interacts with both through <b>DisplayHandle</b> and <b>AssetHandle</b>, which provide stable, name-based references without exposing raw pointers.</p>
<p>At the center of the system is <b>Core</b>, a singleton responsible for configuration, window and renderer setup, the main loop, and coordination of events. <b>Core</b> delegates rendering and updates to the root <b>Stage</b> display object, and works with the <b>EventManager</b> to deliver input and custom events using capture → target → bubble propagation across the display tree. SDL3-specific utilities and abstractions are contained within Core to isolate platform details and keep user-level code simple and testable.</p>
<p>Object and asset lifetimes flow through the <b>Factory</b>. Each concrete type registers its creation functions once; the Factory then creates objects by type and name on request. The Factory maintains a name→instance registry and returns typed handles instead of raw pointers, which decouples reference usage from ownership. This makes it straightforward to reload assets, inspect scene state, support live editing, and build external tooling around stable symbolic names. <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> integrates cleanly into CMake-based applications as a static library (<b>libSDOM.a</b>), and the repository includes example programs and a full automated test harness. External dependencies center on the SDL3 family (<b>video</b>, <b>image</b>, <b>ttf</b>, <b>mixer</b>). Configuration and data-driven object creation are handled through Lua (via sol2). All initialization, UI layout, resources, and behaviors can be expressed in Lua.</p>
<p>The result is a compact, composable framework with well-defined extension points and a predictable runtime model.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Lua Integration (Optional by Design)</h2>
<p><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> provides <b>first-class Lua bindings through sol2</b>, but Lua is <b>not required</b> to use the framework. Developers can freely choose the level of scripting that fits their application:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Usage Mode  </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>No Lua</b>  </td><td class="markdownTableBodyNone">Build your UI entirely in C++. Create display objects and assets directly via <span class="tt">Factory</span>.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Hybrid (Recommended Default)</b>  </td><td class="markdownTableBodyNone">Use Lua to <b>describe scenes</b>, styles, and layout; keep logic in C++.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Full Lua</b>  </td><td class="markdownTableBodyNone">Write your entire application in Lua, creating and controlling display objects dynamically.  </td></tr>
</table>
<p>Regardless of scripting usage:</p>
<blockquote class="doxtable">
<p><b>All rendering, layout, updates, and DOM traversal are executed in C++ — at full native performance.</b> </p>
</blockquote>
<p>Lua calls simply <b>configure or trigger actions</b>, and never run inner draw loops or heavy allocations.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Full-Lua Applications and Future Language Bindings</h2>
<p>While <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> can be used without Lua at all, the system is also designed so that <b>entire applications may be implemented purely in Lua</b>. In this mode, Lua becomes the primary programming environment while <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> provides:</p>
<ul>
<li>The display tree and layout system (IDisplayObject)</li>
<li>The resource/asset system (fonts, textures, audio, etc.)</li>
<li>Event dispatch and input handling</li>
<li>Rendering and scene traversal</li>
</ul>
<p>All of these continue to run at native C++ speed — Lua calls only <em>describe</em> or <em>control</em> behavior, never perform the rendering work themselves.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Roadmap: Full SDL3 Binding for Lua</h3>
<p>The long-term design goal is to expose <b>SDL3 and the SDL ecosystem directly to Lua</b>:</p><ul>
<li><span class="tt">SDL3</span> core (windowing, input, surfaces, textures)</li>
<li><span class="tt">SDL3_ttf</span> (fonts)</li>
<li><span class="tt">SDL3_image</span> (image loading)</li>
<li><span class="tt">SDL3_mixer</span> (audio)</li>
<li><span class="tt">SDL3_video</span> (video playback, once stable)</li>
</ul>
<p>This would allow developers to build <b>fully cross-platform SDL applications in Lua alone</b>, without touching C++ unless desired.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Multi-Language Binding Strategy</h3>
<p>Because <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> is built around <b>handle-based references and centralized resource ownership</b>, it is also structurally well-suited for binding into other languages:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Language  </th><th class="markdownTableHeadCenter">Binding State  </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Lua</b>  </td><td class="markdownTableBodyCenter">✅ Current  </td><td class="markdownTableBodyNone">Scene description + logic  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Python</b>  </td><td class="markdownTableBodyCenter">Planned  </td><td class="markdownTableBodyNone">Likely via <span class="tt">pybind11</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Rust</b>  </td><td class="markdownTableBodyCenter">Planned  </td><td class="markdownTableBodyNone">Likely via <span class="tt">cxx</span> or <span class="tt">bindgen</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Other Languages</b>  </td><td class="markdownTableBodyCenter">Feasible  </td><td class="markdownTableBodyNone">As long as they can call C API boundaries  </td></tr>
</table>
<p>This positions <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> as a <b>portable UI + graphics layer</b> shared across environments.</p>
<blockquote class="doxtable">
<p><b>End-Goal:</b> A unified cross-platform development model where the same display system and SDL interfaces are available in C++, Lua, Rust, Python, and beyond — without rewriting UI stacks per language. </p>
</blockquote>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Configuration Format (Lua Replaces JSON)</h2>
<p>Earlier versions supported JSON, but JSON lacked comments and structural flexibility. Lua tables provide:</p>
<ul>
<li>Human-readable configuration</li>
<li>Conditional layout logic when needed</li>
<li>Component-style reusability</li>
<li>Safe sandboxing support</li>
<li>Zero re-parsing overhead once loaded</li>
</ul>
<p>Lua here functions primarily as a <b>declarative UI configuration language</b>, not a game scripting VM unless the developer wants it to be.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Summary</h2>
<ul>
<li><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> is <b>native-first</b>, deterministic, and real-time–friendly.</li>
<li>Lua is <b>optional</b>, scaling from zero script usage to full application logic.</li>
<li>UI graph traversal and rendering <b>always run in optimized C++</b>.</li>
<li>Configuration is expressed in <b>Lua tables</b>, replacing JSON entirely.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Why SDOM Uses C++ (Memory Safety and Design Intent)</h2>
<p><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> is implemented in C++ by design. Real-time UI requires deterministic control over execution order, rendering, input handling, and memory ownership — all of which are explicit in C++.</p>
<p>While C++ is sometimes labeled “unsafe,” safety is ultimately an architectural responsibility. <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> enforces:</p>
<ul>
<li>Centralized object creation through the Factory <br  />
</li>
<li>Handle-based references instead of raw pointers <br  />
</li>
<li>Explicit lifetime control and cleanup <br  />
</li>
<li>Clear ownership rules for assets and display objects <br  />
</li>
<li>Automated validation through unit tests</li>
</ul>
<p>This eliminates the majority of the error cases associated with ad-hoc memory management.</p>
<p>Languages like Rust provide strong safety features, but still rely on <span class="tt">unsafe</span> blocks when interfacing with SDL, GPU drivers, and system libraries. <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> simply makes those boundaries explicit, rather than hiding them — keeping system behavior transparent and under developer control.</p>
<div class="fragment"><div class="line">==104184== LEAK SUMMARY:</div>
<div class="line">==104184== definitely lost: 0 bytes</div>
<div class="line">==104184== indirectly lost: 0 bytes</div>
<div class="line">==104184== possibly lost: 676,279 bytes (GPU/driver allocations, safe to ignore)</div>
<div class="line">==104184== still reachable: 12,123,577 bytes (expected persistent system buffers)</div>
</div><!-- fragment --><hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
In short:</h2>
<ul>
<li><b>C++ provides deterministic behavior</b> for real-time rendering and event handling.</li>
<li><b>Memory ownership is explicit</b>, not implicit or assumed.</li>
<li><b>Objects and resources are created and destroyed intentionally</b>, not automatically.</li>
<li><b>Safety is enforced structurally</b>, supported by unit tests and centralized lifetime control.</li>
</ul>
<p>This approach ensures <b>performance, predictability, clarity, and extensibility</b> — core goals of <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> as a general-purpose UI and display framework.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
High-Level Architecture Diagram</h2>
<div class="fragment"><div class="line"> -norender</div>
<div class="line">%%{init: { &#39;theme&#39;: &#39;neutral&#39;, &#39;flowchart&#39;: { &#39;curve&#39;: &#39;linear&#39; } }}%%</div>
<div class="line">flowchart TB</div>
<div class="line"> </div>
<div class="line">  %% Styling</div>
<div class="line">  classDef core fill:#eef7ff,stroke:#4a90e2,color:#1a3b5d,stroke-width:1px</div>
<div class="line">  classDef mod  fill:#f7fff0,stroke:#7bb661,color:#234d20,stroke-width:1px</div>
<div class="line">  classDef iface fill:#fff8e6,stroke:#f0ad4e,color:#5a4500,stroke-width:1px</div>
<div class="line">  classDef util fill:#f5f5f5,stroke:#777,color:#222,stroke-width:1px</div>
<div class="line">  classDef dep  fill:#ede9ff,stroke:#7c6fe6,color:#262262,stroke-width:1px</div>
<div class="line">  classDef bin  fill:#e8f9f9,stroke:#22a6b3,color:#125a63,stroke-width:1px</div>
<div class="line"> </div>
<div class="line">  %% Application / Build</div>
<div class="line">  subgraph APP[Application &amp; Build]</div>
<div class="line">    direction TB</div>
<div class="line">    EX[examples/test/prog]:::bin</div>
<div class="line">    LIB[(libSDOM.a)]:::bin</div>
<div class="line">    CMake[CMake Build System]:::util</div>
<div class="line">    EX --&gt;|links| LIB</div>
<div class="line">  end</div>
<div class="line"> </div>
<div class="line">  %% SDOM Library internals</div>
<div class="line">  subgraph SDOM[SDOM Library]</div>
<div class="line">    direction TB</div>
<div class="line"> </div>
<div class="line">    Core[&quot;Core\n(SDL Window / Renderer / Texture)&quot;]:::core</div>
<div class="line"> </div>
<div class="line">    Factory[&quot;Factory (creates + owns objects/assets)&quot;]:::mod</div>
<div class="line">    EventMgr[&quot;EventManager&quot;]:::mod</div>
<div class="line"> </div>
<div class="line">    Stage[&quot;Stage (root DisplayObject)&quot;]:::mod</div>
<div class="line"> </div>
<div class="line">    IDO[&quot;IDisplayObject (scene graph nodes)&quot;]:::iface</div>
<div class="line">    IAO[&quot;IAssetObject (images, fonts, audio, etc.)&quot;]:::iface</div>
<div class="line"> </div>
<div class="line">    DisplayHandle[&quot;DisplayHandle&quot;]:::util</div>
<div class="line">    AssetHandle[&quot;AssetHandle&quot;]:::util</div>
<div class="line"> </div>
<div class="line">    Event[&quot;Event&quot;]:::mod</div>
<div class="line">    EventType[&quot;EventType&quot;]:::mod</div>
<div class="line"> </div>
<div class="line">    %% Connections</div>
<div class="line">    Core --&gt; Factory</div>
<div class="line">    Core --&gt; EventMgr</div>
<div class="line">    Core --&gt; Stage</div>
<div class="line"> </div>
<div class="line">    Factory --&gt; IDO</div>
<div class="line">    Factory --&gt; IAO</div>
<div class="line"> </div>
<div class="line">    Stage --&gt; IDO</div>
<div class="line"> </div>
<div class="line">    IDO --&gt; DisplayHandle</div>
<div class="line">    IAO --&gt; AssetHandle</div>
<div class="line"> </div>
<div class="line">    EventMgr --&gt; Event</div>
<div class="line">    Event --&gt; EventType</div>
<div class="line">  end</div>
<div class="line"> </div>
<div class="line">  %% External Dependencies</div>
<div class="line">  subgraph EXT[External Dependencies]</div>
<div class="line">    SDL3[SDL3]:::dep</div>
<div class="line">    SDLimg[SDL3_image]:::dep</div>
<div class="line">    SDLttf[SDL3_ttf]:::dep</div>
<div class="line">    SDLmix[SDL3_mixer]:::dep</div>
<div class="line">    Sol2[sol2]:::dep</div>
<div class="line">    Lua[Lua 5.3/5.4]:::dep</div>
<div class="line">  end</div>
<div class="line"> </div>
<div class="line">  Core --&gt; SDL3</div>
<div class="line">  Core --&gt; SDLimg</div>
<div class="line">  Core --&gt; SDLttf</div>
<div class="line">  Core --&gt; SDLmix</div>
<div class="line"> </div>
<div class="line">  LIB -. Lua Bindings .-&gt; Sol2</div>
<div class="line">  Sol2 --&gt; Lua</div>
<div class="line"> </div>
<div class="line">  CMake --&gt; LIB</div>
<div class="line">  CMake --&gt; EX</div>
</div><!-- fragment --><p>Notes</p><ul>
<li>Core composes the SDL video subsystem (window, renderer, main texture) and orchestrates the main loop and callbacks.</li>
<li>Factory owns and manages both display objects (IDisplayObject) and resource objects (IResourceObject), exposing safe handles for references.</li>
<li>EventManager implements capture → target → bubble propagation phases across the display tree.</li>
<li>External dependencies include the SDL3 family and sol2 + Lua for scripting.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Runtime Flow (High Level)</h1>
<p>At runtime, an application (e.g., examples/test/prog) configures Core and calls run(). Core brings up the SDL subsystem (window, renderer, texture), ensures the Stage type is registered with the Factory, and creates the root Stage. After Stage::onInit, the main loop repeats: Core asks the EventManager to poll and dispatch input using capture → target → bubble phases across the display tree, then calls Stage::onUpdate(dt) followed by Stage::onRender(). When the program exits, Core performs an orderly shutdown of SDL and any owned systems. The sequence below is intentionally high‑level: it traces control through the primary actors and elides optional utilities and scripting for clarity.</p>
<p>Event propagation across the display tree proceeds in three phases: (1) capture, where the event travels from the root (Stage) down the ancestry path toward the target’s parent, invoking capture-registered listeners along the way; (2) target, where listeners attached to the target itself run; and (3) bubble, where the event ascends back up toward the Stage, invoking bubble-registered listeners on each ancestor. At each hop, the event’s current target reflects the node processing the event, while the logical target remains the original source. Handlers can short‑circuit further delivery (for example, to prevent duplicate handling) and can mark intent for default behavior as needed by the control.</p>
<p>Summary: Core orchestrates startup, the main loop, and shutdown; the Factory resolves names to live objects and resources via typed handles; the Stage anchors the visual tree; and the EventManager channels input through capture → target → bubble so UI code can respond at the appropriate layer. <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> also supports organizing multiple “scenes” or screen layouts by swapping the root of the DOM tree. Each scene is simply a different Stage (or subtree) as the root, so you can transition screens without re‑initializing the engine. The flow below sketches these responsibilities without diving into optional subsystems.</p>
<div class="fragment"><div class="line"> -norender</div>
<div class="line">sequenceDiagram</div>
<div class="line">  autonumber</div>
<div class="line">  participant Prog as examples/test/prog</div>
<div class="line">  participant Core as SDOM::Core</div>
<div class="line">  participant SDL as SDL3 Subsystem</div>
<div class="line">  participant Factory as Factory</div>
<div class="line">  participant Stage as Stage (Root)</div>
<div class="line">  participant EM as EventManager</div>
<div class="line"> </div>
<div class="line">  Prog-&gt;&gt;Core: configure(...)</div>
<div class="line">  Prog-&gt;&gt;Core: run()</div>
<div class="line">  Core-&gt;&gt;SDL: init window/renderer/texture</div>
<div class="line">  Core-&gt;&gt;Factory: ensure Stage type registered</div>
<div class="line">  Core-&gt;&gt;Factory: create&lt;Stage&gt;()</div>
<div class="line">  Factory--&gt;&gt;Core: Stage instance</div>
<div class="line">  Core-&gt;&gt;Stage: onInit()</div>
<div class="line">  loop Main Loop</div>
<div class="line">    Core-&gt;&gt;EM: poll/dispatch events</div>
<div class="line">    EM-&gt;&gt;Stage: propagate events (capture→target→bubble)</div>
<div class="line">    Core-&gt;&gt;Stage: onUpdate(dt)</div>
<div class="line">    Core-&gt;&gt;Stage: onRender()</div>
<div class="line">  end</div>
<div class="line">  Prog--&gt;&gt;Core: onQuit()</div>
<div class="line">  Core-&gt;&gt;SDL: shutdown</div>
</div><!-- fragment --><p>This complements the per-module documents in the <span class="tt">docs/</span> folder (Core framework, anchoring, DOM propagation, extensible factory, handles, etc.). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<footer>
  <a href="#top">Back to top</a> &nbsp;|&nbsp; <a href="https://github.com/warte67/SDOM">Back to SDOM on GitHub</a>
</footer>
