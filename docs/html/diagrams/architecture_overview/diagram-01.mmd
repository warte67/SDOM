%%{init: { 'theme': 'neutral', 'flowchart': { 'curve': 'linear' } }}%%
flowchart TB

  %% Styling
  classDef core fill:#eef7ff,stroke:#4a90e2,color:#1a3b5d,stroke-width:1px
  classDef mod  fill:#f7fff0,stroke:#7bb661,color:#234d20,stroke-width:1px
  classDef iface fill:#fff8e6,stroke:#f0ad4e,color:#5a4500,stroke-width:1px
  classDef util fill:#f5f5f5,stroke:#999,color:#333,stroke-width:1px
  classDef dep  fill:#f2f2ff,stroke:#7c6fe6,color:#262262,stroke-width:1px
  classDef bin  fill:#e8f9f9,stroke:#22a6b3,color:#125a63,stroke-width:1px

  %% Application / Build
  subgraph APP[Application & Build]
    direction TB
    EX[examples/test/prog]:::bin
    LIB[(libSDOM.a)]:::bin
    CMake[CMake Build System]:::util
    EX -->|links| LIB
  end

  %% SDOM Library internals
  subgraph SDOM[SDOM Library]
    direction TB

    %% Top center
    subgraph TOP[" "]
      direction TB
      Core["Core"]:::core
    end

    %% Middle row (left-to-right)
    subgraph MID[" "]
      direction LR
      Stage["Stage (Root)"]:::mod
      Factory["Factory"]:::mod
      EventMgr["EventManager"]:::mod
    end

    %% Lower row (interfaces, events, handles, utils)
    subgraph LOW[" "]
      direction LR
      IDO["IDisplayObject\n(visual tree)"]:::iface
      IRO["IResourceObject\n(resource tree)"]:::iface
      Event["Event"]:::mod
      EventType["EventType"]:::mod
      DomHandle["DomHandle"]:::util
      ResHandle["ResHandle"]:::util
      SDLUtils["SDOM_SDL_Utils"]:::util
    end

    %% Edges from Core
    Core --> Stage
    Core --> Factory
    Core --> EventMgr
    Core --> SDLUtils

    %% Factory creates/owns
    Factory --> IDO
    Factory --> IRO

    %% Stage contains the visual tree
    Stage --> IDO

    %% Events
    EventMgr --> Event
    Event --> EventType

    %% Handles reference types
    IDO --> DomHandle
    IRO --> ResHandle
  end

  %% External dependencies
  subgraph EXT[External Dependencies]
    direction TB
    SDL3[SDL3]:::dep
    SDLimg[SDL3_image]:::dep
    SDLttf[SDL3_ttf]:::dep
    SDLmix[SDL3_mixer]:::dep
    JSON[nlohmann/json]:::dep
    Sol2[sol2]:::dep
    Lua[Lua 5.3/5.4]:::dep
  end

  %% Edges between areas
  Core --> SDL3
  Core --> SDLimg
  Core --> SDLttf
  Core --> SDLmix

  LIB -. uses .-> JSON
  LIB -. optional: bindings .-> Sol2
  Sol2 -. links .-> Lua

  CMake -->|produces| LIB
  CMake -->|builds| EX
