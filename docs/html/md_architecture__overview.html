<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDOM - Simple SDL Document Object Model: Architecture Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SDOM - Simple SDL Document Object Model
   </div>
   <div id="projectbrief">A lightweight, extensible Document Object Model for SDL-based applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_architecture__overview.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Architecture Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<p><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> is a lightweight C++ runtime and library built around a clear separation of concerns: a visual scene graph of display objects and a parallel graph of resources. The display tree is composed of IDisplayObject nodes that participate in layout, anchoring, rendering, and event handling. The resource tree is composed of IResourceObject nodes that own data such as images, fonts, audio, and configuration. Code refers to both worlds with type-safe handles (DomHandle for display objects, ResHandle for resources), keeping ownership centralized while allowing references to remain cheap, portable, and late-bound.</p>
<p>At the center is Core, a singleton that configures the system, owns the SDL window/renderer/texture, and drives the main loop. Core delegates to the Stage (the root display object) for initialization, updates, and rendering, and works with the EventManager to deliver input via capture → target → bubble phases across the display tree. SDL-focused utilities live alongside Core to isolate platform details, keeping application code small and testable.</p>
<p>Creation and lifetime of objects flow through the Factory. Types register themselves once; clients ask the Factory to create by type/name. The Factory maintains a name → pointer registry and returns typed handles rather than raw pointers, which decouples producers of references from the owners of objects. This design makes it straightforward to swap or reload resources, test in isolation, and build tools around a stable naming scheme.</p>
<p>The library integrates cleanly into CMake-based applications as a static archive (libSDOM.a), with an examples/test/prog illustrating usage. External dependencies focus on the SDL3 family (video, image, ttf, mixer). Scripting and data-driven workflows can be layered on top—Lua via sol2 is supported—while configuration can be provided by your preferred format. The result is a small, composable core with clear extension points and a predictable runtime model.</p>
<p><img src="diagrams/architecture_overview/diagram-01.svg" alt="Architecture Diagram" style="pointer-events: none;" class="inline"/></p>
<details >
<summary >
View Mermaid source</summary>
<p></p>
<div class="fragment"><div class="line"> -norender</div>
<div class="line">%%{init: { &#39;theme&#39;: &#39;neutral&#39;, &#39;flowchart&#39;: { &#39;curve&#39;: &#39;linear&#39; } }}%%</div>
<div class="line">flowchart TB</div>
<div class="line"> </div>
<div class="line">  %% Styling</div>
<div class="line">  classDef core fill:#eef7ff,stroke:#4a90e2,color:#1a3b5d,stroke-width:1px</div>
<div class="line">  classDef mod  fill:#f7fff0,stroke:#7bb661,color:#234d20,stroke-width:1px</div>
<div class="line">  classDef iface fill:#fff8e6,stroke:#f0ad4e,color:#5a4500,stroke-width:1px</div>
<div class="line">  classDef util fill:#f5f5f5,stroke:#999,color:#333,stroke-width:1px</div>
<div class="line">  classDef dep  fill:#f2f2ff,stroke:#7c6fe6,color:#262262,stroke-width:1px</div>
<div class="line">  classDef bin  fill:#e8f9f9,stroke:#22a6b3,color:#125a63,stroke-width:1px</div>
<div class="line"> </div>
<div class="line">  %% Application / Build</div>
<div class="line">  subgraph APP[Application &amp; Build]</div>
<div class="line">    direction TB</div>
<div class="line">    EX[examples/test/prog]:::bin</div>
<div class="line">    LIB[(libSDOM.a)]:::bin</div>
<div class="line">    CMake[CMake Build System]:::util</div>
<div class="line">    EX --&gt;|links| LIB</div>
<div class="line">  end</div>
<div class="line"> </div>
<div class="line">  %% SDOM Library internals</div>
<div class="line">  subgraph SDOM[SDOM Library]</div>
<div class="line">    direction TB</div>
<div class="line"> </div>
<div class="line">    %% Top center</div>
<div class="line">    subgraph TOP[&quot; &quot;]</div>
<div class="line">      direction TB</div>
<div class="line">      Core[&quot;Core&quot;]:::core</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    %% Middle row (left-to-right)</div>
<div class="line">    subgraph MID[&quot; &quot;]</div>
<div class="line">      direction LR</div>
<div class="line">      Stage[&quot;Stage (Root)&quot;]:::mod</div>
<div class="line">      Factory[&quot;Factory&quot;]:::mod</div>
<div class="line">      EventMgr[&quot;EventManager&quot;]:::mod</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    %% Lower row (interfaces, events, handles, utils)</div>
<div class="line">    subgraph LOW[&quot; &quot;]</div>
<div class="line">      direction LR</div>
<div class="line">      IDO[&quot;IDisplayObject\n(visual tree)&quot;]:::iface</div>
<div class="line">      IRO[&quot;IResourceObject\n(resource tree)&quot;]:::iface</div>
<div class="line">      Event[&quot;Event&quot;]:::mod</div>
<div class="line">      EventType[&quot;EventType&quot;]:::mod</div>
<div class="line">      DomHandle[&quot;DomHandle&quot;]:::util</div>
<div class="line">      ResHandle[&quot;ResHandle&quot;]:::util</div>
<div class="line">      SDLUtils[&quot;SDOM_SDL_Utils&quot;]:::util</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    %% Edges from Core</div>
<div class="line">    Core --&gt; Stage</div>
<div class="line">    Core --&gt; Factory</div>
<div class="line">    Core --&gt; EventMgr</div>
<div class="line">    Core --&gt; SDLUtils</div>
<div class="line"> </div>
<div class="line">    %% Factory creates/owns</div>
<div class="line">    Factory --&gt; IDO</div>
<div class="line">    Factory --&gt; IRO</div>
<div class="line"> </div>
<div class="line">    %% Stage contains the visual tree</div>
<div class="line">    Stage --&gt; IDO</div>
<div class="line"> </div>
<div class="line">    %% Events</div>
<div class="line">    EventMgr --&gt; Event</div>
<div class="line">    Event --&gt; EventType</div>
<div class="line"> </div>
<div class="line">    %% Handles reference types</div>
<div class="line">    IDO --&gt; DomHandle</div>
<div class="line">    IRO --&gt; ResHandle</div>
<div class="line">  end</div>
<div class="line"> </div>
<div class="line">  %% External dependencies</div>
<div class="line">  subgraph EXT[External Dependencies]</div>
<div class="line">    direction TB</div>
<div class="line">    SDL3[SDL3]:::dep</div>
<div class="line">    SDLimg[SDL3_image]:::dep</div>
<div class="line">    SDLttf[SDL3_ttf]:::dep</div>
<div class="line">    SDLmix[SDL3_mixer]:::dep</div>
<div class="line">    JSON[nlohmann/json]:::dep</div>
<div class="line">    Sol2[sol2]:::dep</div>
<div class="line">    Lua[Lua 5.3/5.4]:::dep</div>
<div class="line">  end</div>
<div class="line"> </div>
<div class="line">  %% Edges between areas</div>
<div class="line">  Core --&gt; SDL3</div>
<div class="line">  Core --&gt; SDLimg</div>
<div class="line">  Core --&gt; SDLttf</div>
<div class="line">  Core --&gt; SDLmix</div>
<div class="line"> </div>
<div class="line">  LIB -. uses .-&gt; JSON</div>
<div class="line">  LIB -. optional: bindings .-&gt; Sol2</div>
<div class="line">  Sol2 -. links .-&gt; Lua</div>
<div class="line"> </div>
<div class="line">  CMake --&gt;|produces| LIB</div>
<div class="line">  CMake --&gt;|builds| EX</div>
</div><!-- fragment --><p></p>
</details>
<p>Notes</p><ul>
<li>Core composes the SDL video subsystem (window, renderer, main texture) and orchestrates the main loop and callbacks.</li>
<li>Factory owns and manages both display objects (IDisplayObject) and resource objects (IResourceObject), exposing safe handles for references.</li>
<li>EventManager implements capture → target → bubble propagation phases across the display tree.</li>
<li>External dependencies include SDL3 family, nlohmann/json, and optionally sol2 + Lua for scripting.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Runtime Flow (High Level)</h1>
<p>At runtime, an application (e.g., examples/test/prog) configures Core and calls run(). Core brings up the SDL subsystem (window, renderer, texture), ensures the Stage type is registered with the Factory, and creates the root Stage. After Stage::onInit, the main loop repeats: Core asks the EventManager to poll and dispatch input using capture → target → bubble phases across the display tree, then calls Stage::onUpdate(dt) followed by Stage::onRender(). When the program exits, Core performs an orderly shutdown of SDL and any owned systems. The sequence below is intentionally high‑level: it traces control through the primary actors and elides optional utilities and scripting for clarity.</p>
<p>Event propagation across the display tree proceeds in three phases: (1) capture, where the event travels from the root (Stage) down the ancestry path toward the target’s parent, invoking capture-registered listeners along the way; (2) target, where listeners attached to the target itself run; and (3) bubble, where the event ascends back up toward the Stage, invoking bubble-registered listeners on each ancestor. At each hop, the event’s current target reflects the node processing the event, while the logical target remains the original source. Handlers can short‑circuit further delivery (for example, to prevent duplicate handling) and can mark intent for default behavior as needed by the control.</p>
<p>Summary: Core orchestrates startup, the main loop, and shutdown; the Factory resolves names to live objects and resources via typed handles; the Stage anchors the visual tree; and the EventManager channels input through capture → target → bubble so UI code can respond at the appropriate layer. <a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> also supports organizing multiple “scenes” or screen layouts by swapping the root of the DOM tree. Each scene is simply a different Stage (or subtree) as the root, so you can transition screens without re‑initializing the engine. The flow below sketches these responsibilities without diving into optional subsystems.</p>
<p><img src="diagrams/architecture_overview/diagram-02.svg" alt="Runtime Flow" style="pointer-events: none;" class="inline"/></p>
<details >
<summary >
View Mermaid source</summary>
<p></p>
<div class="fragment"><div class="line"> -norender</div>
<div class="line">sequenceDiagram</div>
<div class="line">  autonumber</div>
<div class="line">  participant Prog as examples/test/prog</div>
<div class="line">  participant Core as SDOM::Core</div>
<div class="line">  participant SDL as SDL3 Subsystem</div>
<div class="line">  participant Factory as Factory</div>
<div class="line">  participant Stage as Stage (Root)</div>
<div class="line">  participant EM as EventManager</div>
<div class="line"> </div>
<div class="line">  Prog-&gt;&gt;Core: configure(...)</div>
<div class="line">  Prog-&gt;&gt;Core: run()</div>
<div class="line">  Core-&gt;&gt;SDL: init window/renderer/texture</div>
<div class="line">  Core-&gt;&gt;Factory: ensure Stage type registered</div>
<div class="line">  Core-&gt;&gt;Factory: create&lt;Stage&gt;()</div>
<div class="line">  Factory--&gt;&gt;Core: Stage instance</div>
<div class="line">  Core-&gt;&gt;Stage: onInit()</div>
<div class="line">  loop Main Loop</div>
<div class="line">    Core-&gt;&gt;EM: poll/dispatch events</div>
<div class="line">    EM-&gt;&gt;Stage: propagate events (capture→target→bubble)</div>
<div class="line">    Core-&gt;&gt;Stage: onUpdate(dt)</div>
<div class="line">    Core-&gt;&gt;Stage: onRender()</div>
<div class="line">  end</div>
<div class="line">  Prog--&gt;&gt;Core: onQuit()</div>
<div class="line">  Core-&gt;&gt;SDL: shutdown</div>
</div><!-- fragment --><p></p>
</details>
<p>This complements the per-module documents in the <span class="tt">docs/</span> folder (Core framework, anchoring, DOM propagation, extensible factory, handles, etc.). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<footer>
  <a href="https://github.com/warte67/SDOM">Back to SDOM on GitHub</a>
</footer>
