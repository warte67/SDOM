<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDOM - Simple SDL Document Object Model: Scripting and Configuration (Lua &amp; C++)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SDOM - Simple SDL Document Object Model
   </div>
   <div id="projectbrief">A lightweight, extensible Document Object Model for SDL-based applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2scripting__and__configuration.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Scripting and Configuration (Lua &amp; C++) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md303"></a></p>
<p><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> supports two complementary ways to build apps: directly in C++ and via Lua scripting (powered by Sol2). Lua is first‑class but optional—you can adopt it incrementally or run entirely without it. When enabled, Lua accelerates iteration, enables data‑driven scenes, and allows runtime behavior changes without recompilation.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md304"></a>
Goals</h1>
<ul>
<li>Fast iteration and prototyping for UI, scenes, and behaviors</li>
<li>Data‑driven creation of resources and display objects</li>
<li>Runtime stage/scene swapping and dialog scripting</li>
<li>Test harnesses that exercise systems without rebuilding</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md305"></a>
Modes of Use</h1>
<ul>
<li>C++‑only: Construct everything with initializer structs and APIs.</li>
<li>C++ + Lua (hybrid): Use Lua for data/config and glue; keep heavy logic in C++.</li>
<li>Lua‑driven: Define scenes and behavior in Lua; C++ provides performant primitives.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md306"></a>
Integration Points</h1>
<ul>
<li>Factory: Types register creator lambdas that accept either a type‑specific initializer struct or a Lua <span class="tt">sol::table</span>.</li>
<li>Constructors: Each type offers <span class="tt">Type(const InitType&amp;)</span> and <span class="tt">Type(const sol::table&amp;)</span> protected/ private constructors; Factory is a friend.</li>
<li>Lifecycle: Core exposes hooks (init, update, event, render, unit tests) that can call into Lua and vice‑versa.</li>
<li>Scenes: Swap the active Stage (DOM root) at runtime from C++ or Lua.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md307"></a>
Example: Creating with Lua</h1>
<div class="fragment"><div class="line">sol::state lua;</div>
<div class="line">lua.open_libraries(sol::lib::base);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define a display object via a Lua table</span></div>
<div class="line">lua.script(<span class="stringliteral">&quot;box = { name = &#39;myBox&#39;, x = 10, y = 20, width = 200, height = 150 }&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pass the table to the Factory</span></div>
<div class="line"><span class="keyword">auto</span> box = factory-&gt;create(<span class="stringliteral">&quot;Box&quot;</span>, lua[<span class="stringliteral">&quot;box&quot;</span>]);</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md308"></a>
Safety and Performance</h1>
<ul>
<li>Typed handles (DomHandle/ResHandle) decouple references from object lifetimes.</li>
<li>Factory enforces unique names and validates creation; lookups are type‑safe.</li>
<li>Lua boundaries are thin: parse once, then operate on native objects; keep hot paths in C++.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md309"></a>
Source of Truth</h1>
<p>Design docs are living and may evolve. When in doubt, defer to headers/Doxygen and unit tests as the canonical behavior, and open an issue or PR to align docs.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md310"></a>
SDOM API considerations for Lua</h1>
<ul>
<li>Binding conventions:<ul>
<li>Expose minimal, stable surfaces; prefer methods over public fields.</li>
<li>Use clear namespaces/tables (e.g., <span class="tt">sdom.core</span>, <span class="tt">sdom.factory</span>, <span class="tt">sdom.events</span>).</li>
<li>Map enums to string constants or integer values; document both.</li>
</ul>
</li>
<li>Handles and identity:<ul>
<li>Pass DomHandle/ResHandle (or names) into Lua; avoid exposing raw pointers.</li>
<li>Provide <span class="tt">resolve(handle)</span>/<span class="tt">exists(name)</span> helpers to validate before use.</li>
</ul>
</li>
<li>Factory usage:<ul>
<li>Accept <span class="tt">sol::table</span> for creation; validate <span class="tt">name</span> uniqueness and required fields.</li>
<li>Offer typed convenience creators (e.g., <span class="tt">factory:create_box(tbl)</span>) that normalize fields.</li>
</ul>
</li>
<li>Lifecycle hooks:<ul>
<li>Allow registering Lua callbacks for init, update(dt), on_event(evt), render, unit_tests.</li>
<li>Ensure callbacks are optional and isolated; guard with try/catch and logging.</li>
</ul>
</li>
<li>Threading:<ul>
<li>Run Lua on the main thread unless the VM is explicitly made thread‑safe.</li>
<li>If background work is needed, post results/events back to the main thread.</li>
</ul>
</li>
<li>Error handling:<ul>
<li>Convert Lua errors to structured engine logs; show file/line and stack trace.</li>
<li>Fail fast on invalid creations; keep partial state consistent.</li>
</ul>
</li>
<li>Performance:<ul>
<li>Keep hot paths in C++; avoid per‑frame table allocations inside tight loops.</li>
<li>Prefer prebound closures or lightuserdata for frequently called callbacks.</li>
</ul>
</li>
<li>Security/sandboxing:<ul>
<li>Restrict libraries when embedding (only <span class="tt">base</span> by default); whitelist as needed.</li>
<li>Avoid exposing file/network primitives unless required; gate behind config flags.</li>
</ul>
</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md311"></a>
Next steps (Lua integration)</h1>
<ul>
<li>Bind the Factory and core types to Lua (sol2) with a small, documented surface.</li>
<li>Add a Lua demo scene that constructs a Stage and a few DisplayObjects.</li>
<li>Wire lifecycle hooks (<span class="tt">onInit</span>, <span class="tt">onUpdate</span>, <span class="tt">onEvent</span>, <span class="tt">onRender</span>, <span class="tt">onUnitTests</span>) to optional Lua functions.</li>
<li>Provide typed creator helpers and validation for common objects (e.g., Box, Label).</li>
<li>Add unit tests that load Lua scripts to validate creation, events, and anchoring.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md312"></a>
Module-style configuration and lifecycle registration (recommended)</h1>
<p><a class="el" href="namespaceSDOM.html" title="Contains all core classes and utilities for the SDOM library.">SDOM</a> supports module-style Lua configuration files that return a <span class="tt">config</span> table. This keeps globals out of the Lua namespace and is the recommended pattern for portable configs:</p>
<div class="fragment"><div class="line">local config = {</div>
<div class="line">    Core = { windowWidth = 1024, windowHeight = 768, ... }</div>
<div class="line">}</div>
<div class="line">-- Register lifecycle callbacks</div>
<div class="line">Core:registerOn(&quot;Init&quot;, function() print(&quot;OnInit&quot;) end)</div>
<div class="line">Core:registerOn(&quot;Update&quot;, function(dt) end)</div>
<div class="line"> </div>
<div class="line">return config</div>
</div><!-- fragment --><p>Notes:</p><ul>
<li>The embedded Core Lua state exposes <span class="tt">Core</span>, <span class="tt"><a class="el" href="classCLR.html" title="Static container for ANSI escape sequences and formatting helpers.">CLR</a></span>, and unit-test helpers. The <span class="tt">Core:registerOn(name, fn)</span> helper accepts short names (Init, Quit, Update, Event, Render, UnitTest, WindowResize) and binds the provided Lua function as a protected callback.</li>
<li>Config files may either return the config table (preferred) or set a global <span class="tt">config</span> (legacy). The host will prefer the returned table and fall back to the global.</li>
<li>If you rely on <span class="tt">require</span> for modular callbacks, ensure <span class="tt">package.path</span> is set appropriately (examples set a project-relative path in <span class="tt">examples/test/lua/config.lua</span>). </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<footer>
  <a href="#top">Back to top</a> &nbsp;|&nbsp; <a href="https://github.com/warte67/SDOM">Back to SDOM on GitHub</a>
</footer>
