<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDOM - Simple SDL Document Object Model: Label Text Parsing Design Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SDOM - Simple SDL Document Object Model
   </div>
   <div id="projectbrief">A lightweight, extensible Document Object Model for SDL-based applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2label__text__parsing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Label Text Parsing Design Document</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md195"></a> </p>
<h1><a class="anchor" id="autotoc_md196"></a>
Overview</h1>
<p>This document describes the design and implementation strategy for parsing and rendering text in the SDOM2 <code>Label</code> class, including support for word wrapping, inline style changes, escape sequences, and advanced alignment.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md198"></a>
Goals</h1>
<ul>
<li>Support word wrapping and autosizing for labels.</li>
<li>Allow inline style changes (color, bold, underline, etc.) via escape sequences.</li>
<li>Enable mixed horizontal and vertical alignment within a single label.</li>
<li>Efficiently tokenize and process text for rendering.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md200"></a>
## Escape Sequence Syntax</h1>
<h2><a class="anchor" id="autotoc_md201"></a>
Supported Color Names</h2>
<p>You can use any of the following color names in label escape tags (e.g., <code>[color=name]</code>, <code>[fgnd=name]</code>, <code>[bgnd=name]</code>, <code>[border=name]</code>, <code>[outline=name]</code>, <code>[shadow=name]</code>):</p>
<p><b>Grayscale gradient (6 steps):</b></p><ul>
<li><code>black</code> — { 0, 0, 0, 255 }</li>
<li><code>dk_gray</code> — { 51, 51, 51, 255 }</li>
<li><code>md_gray</code> — { 102, 102, 102, 255 }</li>
<li><code>gray</code> — { 153, 153, 153, 255 }</li>
<li><code>lt_gray</code> — { 204, 204, 204, 255 }</li>
<li><code>white</code> — { 255, 255, 255, 255 }</li>
</ul>
<p><b>Light colors:</b></p><ul>
<li><code>lt_red</code> — { 255, 32, 32, 255 }</li>
<li><code>lt_green</code> — { 32, 255, 32, 255 }</li>
<li><code>lt_yellow</code> — { 255, 255, 32, 255 }</li>
<li><code>lt_blue</code> — { 32, 32, 255, 255 }</li>
<li><code>lt_magenta</code> — { 255, 32, 255, 255 }</li>
<li><code>lt_cyan</code> — { 32, 255, 255, 255 }</li>
</ul>
<p><b>Normal colors:</b></p><ul>
<li><code>red</code> — { 224, 0, 0, 255 }</li>
<li><code>green</code> — { 0, 224, 0, 255 }</li>
<li><code>yellow</code> — { 224, 224, 0, 255 }</li>
<li><code>blue</code> — { 0, 0, 224, 255 }</li>
<li><code>magenta</code> — { 224, 0, 224, 255 }</li>
<li><code>cyan</code> — { 0, 224, 224, 255 }</li>
</ul>
<p><b>Dark colors:</b></p><ul>
<li><code>dk_red</code> — { 192, 0, 0, 255 }</li>
<li><code>dk_green</code> — { 0, 192, 0, 255 }</li>
<li><code>dk_yellow</code> — { 192, 192, 0, 255 }</li>
<li><code>dk_blue</code> — { 0, 0, 192, 255 }</li>
<li><code>dk_magenta</code> — { 192, 0, 192, 255 }</li>
<li><code>dk_cyan</code> — { 0, 192, 192, 255 }</li>
</ul>
<p><b>New Colors:</b></p><ul>
<li><code>tan</code> — { 255, 204, 153, 255 }</li>
<li><code>orange</code> — { 255, 128, 0, 255 }</li>
<li><code>brown</code> — { 128, 96, 0, 255 }</li>
<li><code>pink</code> — { 255, 128, 192, 255 }</li>
<li><code>purple</code> — { 128, 0, 128, 255 }</li>
<li><code>violet</code> — { 165, 42, 255, 255 }</li>
<li><code>lavender</code> — { 230, 230, 250, 255 }</li>
<li><code>gold</code> — { 255, 215, 0, 255 }</li>
<li><code>silver</code> — { 192, 192, 192, 255 }</li>
<li><code>bronze</code> — { 205, 127, 50, 255 }</li>
<li><code>lime</code> — { 128, 255, 0, 255 }</li>
<li><code>mint</code> — { 170, 255, 195, 255 }</li>
<li><code>dk_olive</code> — { 64, 64, 0, 255 }</li>
<li><code>olive</code> — { 96, 96, 0, 255 }</li>
<li><code>olive_drab</code> — { 107, 142, 35, 255 }</li>
<li><code>sea_green</code> — { 46, 139, 87, 255 }</li>
<li><code>forest_green</code>— { 34, 139, 34, 255 }</li>
<li><code>sky_blue</code> — { 135, 206, 235, 255 }</li>
<li><code>royal_blue</code> — { 65, 105, 225, 255 }</li>
<li><code>steel_blue</code> — { 70, 130, 180, 255 }</li>
<li><code>midnight_blue</code> — { 25, 25, 112, 255 }</li>
<li><code>crimson</code> — { 220, 20, 60, 255 }</li>
<li><code>maroon</code> — { 128, 0, 0, 255 }</li>
<li><code>coral</code> — { 255, 127, 80, 255 }</li>
<li><code>salmon</code> — { 250, 128, 114, 255 }</li>
<li><code>khaki</code> — { 240, 230, 140, 255 }</li>
<li><code>beige</code> — { 245, 245, 220, 255 }</li>
<li><code>wheat</code> — { 245, 222, 179, 255 }</li>
<li><code>chocolate</code> — { 210, 105, 30, 255 }</li>
<li><code>sienna</code> — { 160, 82, 45, 255 }</li>
<li><code>peru</code> — { 205, 133, 63, 255 }</li>
<li><code>indigo</code> — { 75, 0, 130, 255 }</li>
<li><code>turquoise</code> — { 64, 224, 208, 255 }</li>
<li><code>aquamarine</code> — { 127, 255, 212, 255 }</li>
<li><code>chartreuse</code> — { 127, 255, 0, 255 }</li>
<li><code>teal</code> — { 0, 128, 128, 255 }</li>
<li><code>navy</code> — { 0, 0, 128, 255 }</li>
</ul>
<p><b>Custom Colors:</b></p><ul>
<li><code>[RGB=rrggbb]</code> — Set text color to custom 6-digit hex RGB value (e.g., <code>[RGB=FF8800]</code>)</li>
<li><code>[RGBA=rrggbbaa]</code> — Set text color to custom 8-digit hex RGBA value (e.g., <code>[RGBA=FF8800FF]</code>)</li>
</ul>
<p><b>Note:</b> <br  />
 All color names are case-insensitive. <br  />
 You may use these names in any supported color escape tag.</p>
<h3><a class="anchor" id="autotoc_md202"></a>
Color Targets:</h3>
<div class="fragment"><div class="line">Label::foregroundColor     // &quot;fgnd&quot; (default)</div>
<div class="line">Label::backgroundColor     // &quot;bgnd&quot;</div>
<div class="line">Label::borderColor         // &quot;border&quot;</div>
<div class="line">FontStyle::outlineColor    // &quot;outline&quot;</div>
<div class="line">FontStyle::dropShadowColor // &quot;shadow&quot;</div>
</div><!-- fragment --><ul>
<li><code>[color=yellow:fgnd]</code> — sets the foreground to yellow</li>
<li><code>[color=red:bgnd]</code> — sets the background to red</li>
<li><code>[color=green:border]</code> — sets the border to green</li>
<li><code>[RGB:222222:outline]</code> — sets the outline color to dark gray</li>
<li>`[RGBA:0000007f:shadow] — sets the drop shadow to transparent black</li>
</ul>
<h2><a class="anchor" id="autotoc_md203"></a>
Style</h2>
<ul>
<li><code>[bold]</code> — Bold text</li>
<li><code>[italic]</code> — Italic text</li>
<li><code>[underline]</code> — Underlined text</li>
<li><code>[strike]</code> — Strikethrough text</li>
<li><code>[outline]</code> — Outlined text</li>
<li><code>[dropshadow]</code> — Dropshadow text</li>
<li><code>[reset]</code> — Reset all styles to default</li>
</ul>
<h3><a class="anchor" id="autotoc_md204"></a>
Colors:</h3>
<div class="fragment"><div class="line">SDL_Color Label::foregroundColor = {255, 255, 255, 255}; // &quot;fgnd&quot; (default)</div>
<div class="line">SDL_Color Label::backgroundColor = {0, 0, 0, 0};         // &quot;bgnd&quot;</div>
<div class="line">SDL_Color Label::borderColor = {0, 0, 0, 0};             // &quot;border&quot;</div>
<div class="line">SDL_Color FontStyle::outlineColor = {0, 0, 0, 255};      // &quot;outline&quot;</div>
<div class="line">SDL_Color FontStyle::dropShadowColor = {0, 0, 0, 128};   // &quot;shadow&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md205"></a>
Alignment</h2>
<ul>
<li></li>
</ul>
<h3><a class="anchor" id="autotoc_md206"></a>
Bitfield Encoding for Alignment</h3>
<p>Alignment values can be encoded as bitfields to represent the nine possible text alignment modes:</p>
<div class="fragment"><div class="line">left   = 0b0001</div>
<div class="line">center = 0b0010</div>
<div class="line">right  = 0b0011</div>
<div class="line">top    = 0b0100</div>
<div class="line">middle = 0b1000</div>
<div class="line">bottom = 0b1100</div>
<div class="line"> </div>
<div class="line">(zero bit field indicates DEFAULT horizontal or DEFAULT vertical)</div>
<div class="line"> </div>
<div class="line">// Combined alignments</div>
<div class="line">TOP_LEFT      = top    | left</div>
<div class="line">TOP_CENTER    = top    | center</div>
<div class="line">TOP_RIGHT     = top    | right</div>
<div class="line">MIDDLE_LEFT   = middle | left</div>
<div class="line">MIDDLE_CENTER = middle | center</div>
<div class="line">MIDDLE_RIGHT  = middle | right</div>
<div class="line">BOTTOM_LEFT   = bottom | left</div>
<div class="line">BOTTOM_CENTER = bottom | center</div>
<div class="line">BOTTOM_RIGHT  = bottom | right</div>
</div><!-- fragment --><p>This bitfield approach allows efficient representation and sorting of word tokens into the nine alignment vectors for rendering.</p><ul>
<li><code>[align=left]</code> — Left align</li>
<li><code>[align=center]</code> — Center align (horizontal)</li>
<li><code>[align=right]</code> — Right align</li>
<li><code>[align=top]</code> — Top align</li>
<li><code>[align=middle]</code> — Middle align (vertical)</li>
<li><code>[align=bottom]</code> — Bottom align</li>
</ul>
<h2><a class="anchor" id="autotoc_md207"></a>
Special</h2>
<ul>
<li><code>[[]</code> — Render <code>[</code> character</li>
<li><code>[]]</code> — Render <code>]</code> character</li>
<li><code>\"&lt;/tt&gt;  — Render &lt;tt&gt;"</code> character Escape sequences are used to change rendering state (style, color, alignment) within the label text. Example syntax:<ul>
<li><code>[color=#FF0000]</code> — changes text color to red</li>
<li><code>[bold]</code> — enables bold style</li>
<li><code>[align=center]</code> — sets alignment to center (horizontal or vertical)</li>
<li><code>[reset]</code> — resets all styles to default</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md208"></a>
Escaping Square Brackets</h2>
<p>To render literal square brackets in label text, use double brackets:</p>
<ul>
<li><code>[[]</code> renders a single <code>[</code> character</li>
<li><code>[]]</code> renders a single <code>]</code> character</li>
</ul>
<p>This approach avoids ambiguity with style escape sequences and is user-friendly for authors.</p>
<p>Escape sequences are not rendered as text, but affect the rendering of subsequent tokens.</p>
<h2><a class="anchor" id="autotoc_md209"></a>
Font Size</h2>
<ul>
<li><code>[size=16]</code> — Sets the font size to 16 for all subsequent tokens.</li>
<li><p class="startli"><code>[size=8]</code> — Sets the font size to 8 (e.g., for retro bitmap fonts).</p>
<p class="startli">Note: Inter text size escapes are supported at the beginning of the text string only. Adding size changes mid string may have undefined results.</p>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md211"></a>
Numeric Style Escapes (border / outline / padding / dropshadow)</h1>
<h2><a class="anchor" id="autotoc_md212"></a>
Overview</h2>
<p>These escapes allow inline control of numeric rendering parameters that affect phrase rendering (thickness, padding, and drop-shadow offsets). They complement boolean style escapes (bold, italic, outline-enable, dropshadow-enable) by letting authors tune numeric values inline.</p>
<h2><a class="anchor" id="autotoc_md213"></a>
Syntax</h2>
<ul>
<li><code>[border=N] ... [/border]</code> — set border thickness to N for the enclosed tokens.</li>
<li><code>[outline=N] ... [/outline]</code> — set outline thickness to N for the enclosed tokens.</li>
<li><code>[pad=WxH] ... [/pad]</code> (alias) or <code>[padding=WxH] ... [/padding]</code> — set horizontal and vertical padding to W and H.</li>
<li>Parameter variants:<ul>
<li><code>W</code> sets both horizontal and vertical padding to W.</li>
<li><code>WxH</code> sets <code>padding_horiz = W</code> and <code>padding_vert = H</code>.</li>
</ul>
</li>
<li>Both closing forms (<code>[/pad]</code> and <code>[/padding]</code>) are accepted and restore previous values.<ul>
<li>Example: <code>[pad=5x7]</code> sets padding_horiz=5 and padding_vert=7.</li>
</ul>
</li>
<li><code>[dropshadow=X,Y] ... [/dropshadow]</code> — set drop shadow offsets dropshadowOffsetX=X and dropshadowOffsetY=Y.<ul>
<li>Example: <code>[dropshadow=4,6]</code> sets dropshadowOffsetX=4 and dropshadowOffsetY=6.</li>
</ul>
</li>
</ul>
<p>Notes:</p><ul>
<li>Numeric parameters are integer values. Parameters are validated before conversion; malformed params are ignored (no exception thrown) and the default/current value is retained.</li>
<li>Short forms and synonyms (<code>[pad]</code> vs <code>[padding]</code>) are supported for convenience.</li>
</ul>
<h2><a class="anchor" id="autotoc_md214"></a>
Semantics</h2>
<ul>
<li>Opening tag applies the numeric change to the current style for subsequent tokens until the matching closing tag.</li>
<li>Closing tag restores the previous numeric value(s). Nested tags are supported; restoration uses per-field stacks (or a snapshot stack) so nested overrides restore correctly.</li>
<li>If an opening tag omits a numeric parameter (e.g., <code>[border]</code>), the tag may act as an enable toggle or use a documented default — prefer explicit numeric parameters in tests/scripts.</li>
<li>The numeric fields are stored in <code>FontStyle</code> and exposed to Lua token inspection as:<ul>
<li><code>borderThickness</code>, <code>outlineThickness</code>, <code>padding_horiz</code>, <code>padding_vert</code>, <code>dropshadowOffsetX</code>, <code>dropshadowOffsetY</code></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md215"></a>
Examples</h2>
<ul>
<li>Border thickness 3 for the word "BORDER": <div class="fragment"><div class="line">Start [border=3]BORDER[/border] End</div>
</div><!-- fragment --> <code>BORDER</code> tokens will have <code>style.borderThickness == 3</code>.</li>
<li>Outline and padding: <div class="fragment"><div class="line">[outline=2]O1[/outline] [pad=5x7]P1[/pad]</div>
</div><!-- fragment --><ul>
<li><code>O1</code> will carry <code>style.outlineThickness == 2</code>.</li>
<li><code>P1</code> will carry <code>style.padding_horiz == 5</code> and <code>style.padding_vert == 7</code>.</li>
</ul>
</li>
<li>Dropshadow offsets: <div class="fragment"><div class="line">[dropshadow=4,6]Shadowed[/dropshadow]</div>
</div><!-- fragment --><ul>
<li>Tokens inside will have <code>style.dropshadowOffsetX == 4</code> and <code>style.dropshadowOffsetY == 6</code>.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md216"></a>
Implementation Notes</h2>
<ul>
<li>Tokenizer responsibilities:<ul>
<li>Recognize numeric-parameter escapes and split tag name / parameter string.</li>
<li>Validate numeric parameters (digits, optional separators) before calling std::stoi to avoid exceptions.</li>
<li>Maintain per-field stacks (or a FontStyle snapshot stack) to support nested tags and proper restoration on close.</li>
<li>Record escape tokens with the style state <em>before</em> applying the tag action (current tokenizer semantic). Word tokens are recorded with the style state after applying the action.</li>
</ul>
</li>
<li>Defaults and documentation:<ul>
<li>Ensure header defaults in <code><a class="el" href="SDOM__IFontObject_8hpp.html">SDOM_IFontObject.hpp</a></code> and doc defaults match (synchronize default values in docs and headers).</li>
</ul>
</li>
<li>Lua bindings / testing:<ul>
<li><code>DisplayHandle:getTokenList()</code> returns tokens where <code>token.style</code> includes numeric fields named exactly as in <code>FontStyle</code>.</li>
<li>Add unit tests (Label_test5) that create labels containing the numeric escapes, call <code>tokenizeText()</code>, then assert the expected numeric values are present on the word tokens inside the tags.</li>
</ul>
</li>
<li>Error handling:<ul>
<li>On malformed numeric params, avoid throwing — log or ignore and continue. Tests should assert presence of values only when syntactically valid parameters are used.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md217"></a>
Test seed suggestion (Label_test5)</h2>
<div class="fragment"><div class="line">local txt = &quot;Start [border=3]B1[/border] [outline=2]O1[/outline] [pad=5x7]P1[/pad] [dropshadow=4,6]DS1[/dropshadow] End&quot;</div>
</div><!-- fragment --><ul>
<li>After <code>h:setText(txt)</code> and <code>h:tokenizeText()</code>, verify that the relevant word tokens expose:<ul>
<li><code>style.borderThickness == 3</code></li>
<li><code>style.outlineThickness == 2</code></li>
<li><code>style.padding_horiz == 5</code> and <code>style.padding_vert == 7</code></li>
<li><code>style.dropshadowOffsetX == 4</code> and <code>style.dropshadowOffsetY == 6</code></li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md219"></a>
Token Structure</h1>
<p>Each parsed token represents either a word or an escape sequence:</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> TokenType { <a class="code hl_define" href="SDOM__CLR_8hpp.html#abf4ef44c4c8719bd6d059ca8cdbe0fde">Word</a>, Escape };</div>
<div class="line"><span class="keyword">struct </span>LabelToken {</div>
<div class="line">    TokenType type;</div>
<div class="line">    std::string text;      <span class="comment">// For words</span></div>
<div class="line">    std::string escape;    <span class="comment">// For escape sequences</span></div>
<div class="line">    LabelStyle style;      <span class="comment">// Style at this token</span></div>
<div class="line">};</div>
<div class="ttc" id="aSDOM__CLR_8hpp_html_abf4ef44c4c8719bd6d059ca8cdbe0fde"><div class="ttname"><a href="SDOM__CLR_8hpp.html#abf4ef44c4c8719bd6d059ca8cdbe0fde">Word</a></div><div class="ttdeci">#define Word</div><div class="ttdef"><b>Definition</b> SDOM_CLR.hpp:46</div></div>
</div><!-- fragment --><p><b>Word tokens</b>: Actual text to render, with associated style and alignment. <b>Escape tokens</b>: Instructions to change style, color, alignment, etc.</p>
<p><b>Token Types:</b></p><ul>
<li>Word: Plain text, whitespace, punctuation</li>
<li>Escape: Style change, color, font, alignment</li>
<li>Bracket Escape: Literal '[' or ']'</li>
</ul>
<h2><a class="anchor" id="autotoc_md220"></a>
Word Tokenization Rules</h2>
<ul>
<li>Quoted text (enclosed in double quotes) is tokenized as word tokens, but spaces and punctuation within the quoted text are still tokenized as individual word tokens (not grouped).</li>
<li>Escape sequences occurring within a double-quote block are treated as word tokens, not escape tokens.</li>
<li>To render a literal double quote character, use the escape sequence <code>["].&lt;/tt&gt;
- Single quotes are always tokenized as punctuation or as part of a word (e.g., apostrophes).
@subsubsection autotoc_md221 Example tokenization:
Input: 
@icode 
"Hello, [b]world!" 'test' ["]  Output: <div class="fragment"><div class="line">&quot;</div>
<div class="line">Hello</div>
<div class="line">,</div>
<div class="line">[b]</div>
<div class="line">world</div>
<div class="line">!</div>
<div class="line">&quot;</div>
<div class="line">&#39;</div>
<div class="line">test</div>
<div class="line">&#39;</div>
<div class="line">&quot;</div>
</div><!-- fragment --><ul>
<li>Word tokens are sequences of characters not part of escape sequences or bracket escapes.</li>
<li>Token boundaries are defined by:<ul>
<li>Whitespace (space, tab, newline)</li>
<li>Escape sequence start (<code>[</code>)</li>
<li>Bracket escapes (<code>[[]</code>, <code>[]]</code>)</li>
</ul>
</li>
</ul>
</code></li>
<li><code>Punctuation marks (e.g., <code>.</code>, <code>,</code>, <code>!</code>, <code>?</code>) are each treated as their own word token.</code></li>
<li><code>Spaces are each treated as their own token (one space-per-token), allowing for adjustable space width.</code></li>
<li><code>Tabs (<code>\t</code>) are treated as their own token.</code></li>
<li><code>Newlines (<code>\n</code>) are treated as their own token.</code></li>
<li><code>Words are sequences of non-whitespace, non-punctuation, non-escape, and non-bracket characters.</code></li>
<li><p class="startli"><code>Example tokenization:</p><ul>
<li>Input: <code>Hello, [b]world[[]]![]]\t\n</code></li>
<li>Tokens: <code>Hello</code>, <code>,</code>, , , <code>[b]</code>, <code>world</code>, <code>[[]]</code>, <code>!</code>, <code>[]]</code>, <code>\t</code>, <code>\n</code></li>
</ul>
<p></code></p>
<p class="startli"><code> <b>Special Cases:</b></p><ul>
<li>Bracket escapes (<code>[[]</code>, <code>[]]</code>) are treated as single tokens, not split into word/escape.</li>
<li>Escape sequences (e.g., <code>[b]</code>, <code>[color=red]</code>) are not part of word tokens.</li>
</ul>
<p></code></p>
</li>
<li><code><b>Escape tokens</b>: Instructions to change style, color, alignment, etc.</code></li>
</ul>
<p><code></code></p>
<h2><a class="anchor" id="autotoc_md222"></a>
Escape Tokenization Rules</h2>
<p><code></code></p>
<p><code></p><ul>
<li>Escape tokens are recognized as pairs of square brackets (e.g., <code>[b]</code>, <code>[color=red]</code>, <code>[reset]</code>) that are not within an enclosing double-quote block.</li>
<li>Any sequence starting with <code>[</code> and ending with <code>]</code> outside of double quotes is treated as an escape token.</li>
<li>Escape tokens inside double quotes are treated as word tokens, not escape tokens.</li>
<li>Bracket escapes (<code>[[]</code>, <code>[]]</code>) are not treated as escape tokens, but as word tokens representing literal brackets.</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md224"></a>
Parsing Algorithm</h1>
<p><code></p><ol type="1">
<li><b>Initialize</b> default <code>LabelStyle</code>.</li>
<li><b>Scan input string</b>:<ul>
<li>When an escape sequence is encountered, parse and update the current <code>LabelStyle</code>.</li>
<li>When a word is encountered, create a token with the current style and alignment.</li>
</ul>
</li>
<li><b>Store tokens</b> in a list for further processing.</li>
</ol>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md226"></a>
Alignment Handling</h1>
<p><code></p><ul>
<li>Each word token carries its own alignment (horizontal and vertical) from <code>LabelStyle</code>.</li>
<li>For rendering, tokens are sorted into nine groups based on alignment:<ul>
<li>LEFT+TOP, LEFT+MIDDLE, LEFT+BOTTOM</li>
<li>CENTER+TOP, CENTER+MIDDLE, CENTER+BOTTOM</li>
<li>RIGHT+TOP, RIGHT+MIDDLE, RIGHT+BOTTOM</li>
</ul>
</li>
<li>Each group is rendered according to its alignment rules.</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md228"></a>
Word Wrapping &amp; Autosizing</h1>
<p><code></p><ul>
<li>Measure each word using font metrics.</li>
<li>Accumulate words into lines, wrapping when the line width exceeds label bounds (minus padding).</li>
<li>If <code>auto_width</code> or <code>auto_height</code> is enabled, adjust label bounds to fit content.</li>
<li>If not, clip content to label bounds.</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md230"></a>
Rendering</h1>
<p><code></p><ul>
<li>For each line and token:<ul>
<li>Apply the token's style and alignment.</li>
<li>Render the word using the associated font and style.</li>
<li>Skip rendering for escape tokens.</li>
</ul>
</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md232"></a>
Extensibility</h1>
<p><code></p><ul>
<li>New escape sequences can be added for additional styles (e.g., outline, dropshadow).</li>
<li>The tokenization and rendering logic is modular, allowing future expansion (e.g., hyperlinks, images).</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md234"></a>
Example</h1>
<p><code> </p><div class="fragment"><div class="line">[bold][color=#00FF00]Score:[reset] 100 [align=right][color=#FF0000]Game Over</div>
</div><!-- fragment --><ul>
<li>"Score:" is bold and green.</li>
<li>"100" is default style.</li>
<li>"Game Over" is right-aligned and red.</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md236"></a>
Implementation Notes</h1>
<p><code></code></p>
<p><code></code></p>
<h2><a class="anchor" id="autotoc_md237"></a>
Label Sizing and Wrapping Rules</h2>
<p><code></code></p>
<p><code></p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">wordwrap   </th><th class="markdownTableHeadNone">auto_width   </th><th class="markdownTableHeadNone">auto_height   </th><th class="markdownTableHeadNone">clip_to_parent   </th><th class="markdownTableHeadNone">Behavior    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Single line, fixed size, overflow is clipped at label bounds.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Single line, label expands width to fit text, height fixed.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Single line, width fixed, label expands height (rare, but possible).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Single line, label expands both width and height to fit text.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Multi-line, fixed size, overflow is clipped at label bounds.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Multi-line, label expands width to fit longest wrapped line, height fixed. Max width is clamped to the minimum of a user-specified value (if set) and the parent's right edge.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Multi-line, width fixed, label expands height to fit all lines.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">true   </td><td class="markdownTableBodyNone">any   </td><td class="markdownTableBodyNone">Multi-line, label expands both width and height to fit all text.   </td></tr>
</table>
<p></code></p>
<p><code><b>Note:</b> For both axes, the maximum auto_width/auto_height should be clamped to the minimum of a user-specified maximum (if provided) and the label's parent's bounds. This ensures the label never exceeds its parent's area or a user-imposed limit.</code></p>
<p><code></p><ul>
<li>If <code>clip_to_parent</code> is true, always clip rendering to parent’s bounds, regardless of label size.</li>
</ul>
<p></code></p>
<p><code></code></p>
<h2><a class="anchor" id="autotoc_md238"></a>
Implementation Notes</h2>
<p><code></p><ul>
<li>When <code>auto_width</code> or <code>auto_height</code> is true, recalculate the label’s size after tokenizing/layout.</li>
<li>When <code>clip_to_parent</code> is true, use SDL’s clipping/scissor rect to restrict rendering.</li>
<li>Always document these behaviors for other developers.</li>
</ul>
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md239"></a>
Rendering Phases (Functions):</h1>
<p><code> </code></p>
<h2><a class="anchor" id="autotoc_md240"></a>
1. Pre-Render Layout &amp; Bounds Adjustment</h2>
<p><code></p><ul>
<li><b>Purpose:</b> Calculate the final size and position of the label before rendering.</li>
<li><b>Actions:</b><ul>
<li>Use tokenizeText() to break the text into tokens.</li>
<li>Measure the required width/height based on tokens, wordwrap, and style. -If auto_width/auto_height is enabled, adjust the label’s bounds.</li>
<li>If clip_to_parent or similar is enabled, set up the SDL clip/scissor region to the label or parent bounds. </li>
</ul>
</li>
</ul>
<p></code></p>
<h2><a class="anchor" id="autotoc_md241"></a>
2. Phrase Grouping</h2>
<p><code></p><ul>
<li><b>Purpose:</b> Group tokens into “phrases” (runs of tokens with identical rendering attributes and on the same line).- <b>Actions:</b><ul>
<li>Iterate through each alignment list.</li>
<li>For each line, group consecutive tokens with the same <code>FontStyle</code> (or at least the same visual attributes).</li>
<li>Store these as <code>PhraseToken</code> objects: <code>{startX, text, style, lineY, ...}</code> in a new map, e.g. <code>std::map&lt;AlignQueue, std::vector&lt;PhraseToken&gt;&gt; phraseAlignLists_;</code> </li>
</ul>
</li>
</ul>
<p></code></p>
<h2><a class="anchor" id="autotoc_md242"></a>
3. Phrase Rendering</h2>
<p><code></p><ul>
<li><b>Purpose:</b> Render each phrase efficiently and with correct visual effects.</li>
<li><b>Actions:</b><ul>
<li>For each phrase in order:<ul>
<li>If TTF: Use <code>TTF_RenderText_Blended()</code> for the phrase.</li>
<li><code>BitmapFont</code>: This should also render text in phrase groups adding display attributes like TruetypeFont does.</li>
<li>Apply all style effects (underline, strikethrough, outline, dropshadow, etc.) at the phrase level.</li>
<li>Render backgrounds, borders, etc., as needed.</li>
</ul>
</li>
<li>Restore the previous SDL clip region if it was changed.</li>
</ul>
</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code></code></p>
<h1><a class="anchor" id="autotoc_md244"></a>
References</h1>
<p><code></p><ul>
<li>SDOM2 <code>Label</code> class</li>
<li><code>LabelStyle</code> and <code>FontStyle</code> structs</li>
<li>SDL2/SDL3 rendering best practices</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p></code></p>
<p><code><em>This document will be updated as the implementation progresses.</em> </code></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<footer>
  <a href="#top">Back to top</a> &nbsp;|&nbsp; <a href="https://github.com/warte67/SDOM">Back to SDOM on GitHub</a>
</footer>