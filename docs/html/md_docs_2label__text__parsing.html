<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDOM - Simple SDL Document Object Model: Label Text Parsing Design Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SDOM - Simple SDL Document Object Model
   </div>
   <div id="projectbrief">A lightweight, extensible Document Object Model for SDL-based applications.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2label__text__parsing.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Label Text Parsing Design Document </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md189"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md190"></a>
Overview</h1>
<p>This document describes the design and implementation strategy for parsing and rendering text in the SDOM2 <span class="tt">Label</span> class, including support for word wrapping, inline style changes, escape sequences, and advanced alignment.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md192"></a>
Goals</h1>
<ul>
<li>Support word wrapping and autosizing for labels.</li>
<li>Allow inline style changes (color, bold, underline, etc.) via escape sequences.</li>
<li>Enable mixed horizontal and vertical alignment within a single label.</li>
<li>Efficiently tokenize and process text for rendering.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md194"></a>
## Escape Sequence Syntax</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md195"></a>
Supported Color Names</h2>
<p>You can use any of the following color names in label escape tags (e.g., <span class="tt">[color=name]</span>, <span class="tt">[fgnd=name]</span>, <span class="tt">[bgnd=name]</span>, <span class="tt">[border=name]</span>, <span class="tt">[outline=name]</span>, <span class="tt">[shadow=name]</span>):</p>
<p><b>Grayscale gradient (6 steps):</b></p><ul>
<li><span class="tt">black</span> — { 0, 0, 0, 255 }</li>
<li><span class="tt">dk_gray</span> — { 51, 51, 51, 255 }</li>
<li><span class="tt">md_gray</span> — { 102, 102, 102, 255 }</li>
<li><span class="tt">gray</span> — { 153, 153, 153, 255 }</li>
<li><span class="tt">lt_gray</span> — { 204, 204, 204, 255 }</li>
<li><span class="tt">white</span> — { 255, 255, 255, 255 }</li>
</ul>
<p><b>Light colors:</b></p><ul>
<li><span class="tt">lt_red</span> — { 255, 32, 32, 255 }</li>
<li><span class="tt">lt_green</span> — { 32, 255, 32, 255 }</li>
<li><span class="tt">lt_yellow</span> — { 255, 255, 32, 255 }</li>
<li><span class="tt">lt_blue</span> — { 32, 32, 255, 255 }</li>
<li><span class="tt">lt_magenta</span> — { 255, 32, 255, 255 }</li>
<li><span class="tt">lt_cyan</span> — { 32, 255, 255, 255 }</li>
</ul>
<p><b>Normal colors:</b></p><ul>
<li><span class="tt">red</span> — { 224, 0, 0, 255 }</li>
<li><span class="tt">green</span> — { 0, 224, 0, 255 }</li>
<li><span class="tt">yellow</span> — { 224, 224, 0, 255 }</li>
<li><span class="tt">blue</span> — { 0, 0, 224, 255 }</li>
<li><span class="tt">magenta</span> — { 224, 0, 224, 255 }</li>
<li><span class="tt">cyan</span> — { 0, 224, 224, 255 }</li>
</ul>
<p><b>Dark colors:</b></p><ul>
<li><span class="tt">dk_red</span> — { 192, 0, 0, 255 }</li>
<li><span class="tt">dk_green</span> — { 0, 192, 0, 255 }</li>
<li><span class="tt">dk_yellow</span> — { 192, 192, 0, 255 }</li>
<li><span class="tt">dk_blue</span> — { 0, 0, 192, 255 }</li>
<li><span class="tt">dk_magenta</span> — { 192, 0, 192, 255 }</li>
<li><span class="tt">dk_cyan</span> — { 0, 192, 192, 255 }</li>
</ul>
<p><b>New Colors:</b></p><ul>
<li><span class="tt">tan</span> — { 255, 204, 153, 255 }</li>
<li><span class="tt">orange</span> — { 255, 128, 0, 255 }</li>
<li><span class="tt">brown</span> — { 128, 96, 0, 255 }</li>
<li><span class="tt">pink</span> — { 255, 128, 192, 255 }</li>
<li><span class="tt">purple</span> — { 128, 0, 128, 255 }</li>
<li><span class="tt">violet</span> — { 165, 42, 255, 255 }</li>
<li><span class="tt">lavender</span> — { 230, 230, 250, 255 }</li>
<li><span class="tt">gold</span> — { 255, 215, 0, 255 }</li>
<li><span class="tt">silver</span> — { 192, 192, 192, 255 }</li>
<li><span class="tt">bronze</span> — { 205, 127, 50, 255 }</li>
<li><span class="tt">lime</span> — { 128, 255, 0, 255 }</li>
<li><span class="tt">mint</span> — { 170, 255, 195, 255 }</li>
<li><span class="tt">dk_olive</span> — { 64, 64, 0, 255 }</li>
<li><span class="tt">olive</span> — { 96, 96, 0, 255 }</li>
<li><span class="tt">olive_drab</span> — { 107, 142, 35, 255 }</li>
<li><span class="tt">sea_green</span> — { 46, 139, 87, 255 }</li>
<li><span class="tt">forest_green</span>— { 34, 139, 34, 255 }</li>
<li><span class="tt">sky_blue</span> — { 135, 206, 235, 255 }</li>
<li><span class="tt">royal_blue</span> — { 65, 105, 225, 255 }</li>
<li><span class="tt">steel_blue</span> — { 70, 130, 180, 255 }</li>
<li><span class="tt">midnight_blue</span> — { 25, 25, 112, 255 }</li>
<li><span class="tt">crimson</span> — { 220, 20, 60, 255 }</li>
<li><span class="tt">maroon</span> — { 128, 0, 0, 255 }</li>
<li><span class="tt">coral</span> — { 255, 127, 80, 255 }</li>
<li><span class="tt">salmon</span> — { 250, 128, 114, 255 }</li>
<li><span class="tt">khaki</span> — { 240, 230, 140, 255 }</li>
<li><span class="tt">beige</span> — { 245, 245, 220, 255 }</li>
<li><span class="tt">wheat</span> — { 245, 222, 179, 255 }</li>
<li><span class="tt">chocolate</span> — { 210, 105, 30, 255 }</li>
<li><span class="tt">sienna</span> — { 160, 82, 45, 255 }</li>
<li><span class="tt">peru</span> — { 205, 133, 63, 255 }</li>
<li><span class="tt">indigo</span> — { 75, 0, 130, 255 }</li>
<li><span class="tt">turquoise</span> — { 64, 224, 208, 255 }</li>
<li><span class="tt">aquamarine</span> — { 127, 255, 212, 255 }</li>
<li><span class="tt">chartreuse</span> — { 127, 255, 0, 255 }</li>
<li><span class="tt">teal</span> — { 0, 128, 128, 255 }</li>
<li><span class="tt">navy</span> — { 0, 0, 128, 255 }</li>
</ul>
<p><b>Custom Colors:</b></p><ul>
<li><span class="tt">[RGB=rrggbb]</span> — Set text color to custom 6-digit hex RGB value (e.g., <span class="tt">[RGB=FF8800]</span>)</li>
<li><span class="tt">[RGBA=rrggbbaa]</span> — Set text color to custom 8-digit hex RGBA value (e.g., <span class="tt">[RGBA=FF8800FF]</span>)</li>
</ul>
<p><b>Note:</b> <br  />
 All color names are case-insensitive. <br  />
 You may use these names in any supported color escape tag.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md196"></a>
Color Targets:</h3>
<div class="fragment"><div class="line">Label::foregroundColor     // &quot;fgnd&quot; (default)</div>
<div class="line">Label::backgroundColor     // &quot;bgnd&quot;</div>
<div class="line">Label::borderColor         // &quot;border&quot;</div>
<div class="line">FontStyle::outlineColor    // &quot;outline&quot;</div>
<div class="line">FontStyle::dropShadowColor // &quot;shadow&quot;</div>
</div><!-- fragment --><ul>
<li><span class="tt">[color=yellow:fgnd]</span> — sets the foreground to yellow</li>
<li><span class="tt">[color=red:bgnd]</span> — sets the background to red</li>
<li><span class="tt">[color=green:border]</span> — sets the border to green</li>
<li><span class="tt">[RGB:222222:outline]</span> — sets the outline color to dark gray</li>
<li>`[RGBA:0000007f:shadow] — sets the drop shadow to transparent black</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md197"></a>
Style</h2>
<ul>
<li><span class="tt">[bold]</span> — Bold text</li>
<li><span class="tt">[italic]</span> — Italic text</li>
<li><span class="tt">[underline]</span> — Underlined text</li>
<li><span class="tt">[strike]</span> — Strikethrough text</li>
<li><span class="tt">[outline]</span> — Outlined text</li>
<li><span class="tt">[dropshadow]</span> — Dropshadow text</li>
<li><span class="tt">[reset]</span> — Reset all styles to default</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md198"></a>
Colors:</h3>
<div class="fragment"><div class="line">SDL_Color Label::foregroundColor = {255, 255, 255, 255}; // &quot;fgnd&quot; (default)</div>
<div class="line">SDL_Color Label::backgroundColor = {0, 0, 0, 0};         // &quot;bgnd&quot;</div>
<div class="line">SDL_Color Label::borderColor = {0, 0, 0, 0};             // &quot;border&quot;</div>
<div class="line">SDL_Color FontStyle::outlineColor = {0, 0, 0, 255};      // &quot;outline&quot;</div>
<div class="line">SDL_Color FontStyle::dropShadowColor = {0, 0, 0, 128};   // &quot;shadow&quot;</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md199"></a>
Alignment</h2>
<ul>
<li></li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md200"></a>
Bitfield Encoding for Alignment</h3>
<p>Alignment values can be encoded as bitfields to represent the nine possible text alignment modes:</p>
<div class="fragment"><div class="line">left   = 0b0001</div>
<div class="line">center = 0b0010</div>
<div class="line">right  = 0b0011</div>
<div class="line">top    = 0b0100</div>
<div class="line">middle = 0b1000</div>
<div class="line">bottom = 0b1100</div>
<div class="line"> </div>
<div class="line">(zero bit field indicates DEFAULT horizontal or DEFAULT vertical)</div>
<div class="line"> </div>
<div class="line">// Combined alignments</div>
<div class="line">TOP_LEFT      = top    | left</div>
<div class="line">TOP_CENTER    = top    | center</div>
<div class="line">TOP_RIGHT     = top    | right</div>
<div class="line">MIDDLE_LEFT   = middle | left</div>
<div class="line">MIDDLE_CENTER = middle | center</div>
<div class="line">MIDDLE_RIGHT  = middle | right</div>
<div class="line">BOTTOM_LEFT   = bottom | left</div>
<div class="line">BOTTOM_CENTER = bottom | center</div>
<div class="line">BOTTOM_RIGHT  = bottom | right</div>
</div><!-- fragment --><p>This bitfield approach allows efficient representation and sorting of word tokens into the nine alignment vectors for rendering.</p><ul>
<li><span class="tt">[align=left]</span> — Left align</li>
<li><span class="tt">[align=center]</span> — Center align (horizontal)</li>
<li><span class="tt">[align=right]</span> — Right align</li>
<li><span class="tt">[align=top]</span> — Top align</li>
<li><span class="tt">[align=middle]</span> — Middle align (vertical)</li>
<li><span class="tt">[align=bottom]</span> — Bottom align</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md201"></a>
Special</h2>
<ul>
<li><span class="tt">[[]</span> — Render <span class="tt">[</span> character</li>
<li><span class="tt">[]]</span> — Render <span class="tt">]</span> character</li>
<li><span class="tt">\"&lt;/tt&gt;  — Render &lt;tt&gt;"</span> character Escape sequences are used to change rendering state (style, color, alignment) within the label text. Example syntax:<ul>
<li><span class="tt">[color=#FF0000]</span> — changes text color to red</li>
<li><span class="tt">[bold]</span> — enables bold style</li>
<li><span class="tt">[align=center]</span> — sets alignment to center (horizontal or vertical)</li>
<li><span class="tt">[reset]</span> — resets all styles to default</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md202"></a>
Escaping Square Brackets</h2>
<p>To render literal square brackets in label text, use double brackets:</p>
<ul>
<li><span class="tt">[[]</span> renders a single <span class="tt">[</span> character</li>
<li><span class="tt">[]]</span> renders a single <span class="tt">]</span> character</li>
</ul>
<p>This approach avoids ambiguity with style escape sequences and is user-friendly for authors.</p>
<p>Escape sequences are not rendered as text, but affect the rendering of subsequent tokens.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md203"></a>
Font Size</h2>
<ul>
<li><span class="tt">[size=16]</span> — Sets the font size to 16 for all subsequent tokens.</li>
<li><p class="startli"><span class="tt">[size=8]</span> — Sets the font size to 8 (e.g., for retro bitmap fonts).</p>
<p class="startli">Note: Inter text size escapes are supported at the beginning of the text string only. Adding size changes mid string may have undefined results.</p>
</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md205"></a>
Numeric Style Escapes (border / outline / padding / dropshadow)</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md206"></a>
Overview</h2>
<p>These escapes allow inline control of numeric rendering parameters that affect phrase rendering (thickness, padding, and drop-shadow offsets). They complement boolean style escapes (bold, italic, outline-enable, dropshadow-enable) by letting authors tune numeric values inline.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md207"></a>
Syntax</h2>
<ul>
<li><span class="tt">[border=N] ... [/border]</span> — set border thickness to N for the enclosed tokens.</li>
<li><span class="tt">[outline=N] ... [/outline]</span> — set outline thickness to N for the enclosed tokens.</li>
<li><span class="tt">[pad=WxH] ... [/pad]</span> (alias) or <span class="tt">[padding=WxH] ... [/padding]</span> — set horizontal and vertical padding to W and H.</li>
<li>Parameter variants:<ul>
<li><span class="tt">W</span> sets both horizontal and vertical padding to W.</li>
<li><span class="tt">WxH</span> sets <span class="tt">padding_horiz = W</span> and <span class="tt">padding_vert = H</span>.</li>
</ul>
</li>
<li>Both closing forms (<span class="tt">[/pad]</span> and <span class="tt">[/padding]</span>) are accepted and restore previous values.<ul>
<li>Example: <span class="tt">[pad=5x7]</span> sets padding_horiz=5 and padding_vert=7.</li>
</ul>
</li>
<li><span class="tt">[dropshadow=X,Y] ... [/dropshadow]</span> — set drop shadow offsets dropshadowOffsetX=X and dropshadowOffsetY=Y.<ul>
<li>Example: <span class="tt">[dropshadow=4,6]</span> sets dropshadowOffsetX=4 and dropshadowOffsetY=6.</li>
</ul>
</li>
</ul>
<p>Notes:</p><ul>
<li>Numeric parameters are integer values. Parameters are validated before conversion; malformed params are ignored (no exception thrown) and the default/current value is retained.</li>
<li>Short forms and synonyms (<span class="tt">[pad]</span> vs <span class="tt">[padding]</span>) are supported for convenience.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md208"></a>
Semantics</h2>
<ul>
<li>Opening tag applies the numeric change to the current style for subsequent tokens until the matching closing tag.</li>
<li>Closing tag restores the previous numeric value(s). Nested tags are supported; restoration uses per-field stacks (or a snapshot stack) so nested overrides restore correctly.</li>
<li>If an opening tag omits a numeric parameter (e.g., <span class="tt">[border]</span>), the tag may act as an enable toggle or use a documented default — prefer explicit numeric parameters in tests/scripts.</li>
<li>The numeric fields are stored in <span class="tt">FontStyle</span> and exposed to Lua token inspection as:<ul>
<li><span class="tt">borderThickness</span>, <span class="tt">outlineThickness</span>, <span class="tt">padding_horiz</span>, <span class="tt">padding_vert</span>, <span class="tt">dropshadowOffsetX</span>, <span class="tt">dropshadowOffsetY</span></li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md209"></a>
Examples</h2>
<ul>
<li>Border thickness 3 for the word "BORDER": <div class="fragment"><div class="line">Start [border=3]BORDER[/border] End</div>
</div><!-- fragment --> <span class="tt">BORDER</span> tokens will have <span class="tt">style.borderThickness == 3</span>.</li>
<li>Outline and padding: <div class="fragment"><div class="line">[outline=2]O1[/outline] [pad=5x7]P1[/pad]</div>
</div><!-- fragment --><ul>
<li><span class="tt">O1</span> will carry <span class="tt">style.outlineThickness == 2</span>.</li>
<li><span class="tt">P1</span> will carry <span class="tt">style.padding_horiz == 5</span> and <span class="tt">style.padding_vert == 7</span>.</li>
</ul>
</li>
<li>Dropshadow offsets: <div class="fragment"><div class="line">[dropshadow=4,6]Shadowed[/dropshadow]</div>
</div><!-- fragment --><ul>
<li>Tokens inside will have <span class="tt">style.dropshadowOffsetX == 4</span> and <span class="tt">style.dropshadowOffsetY == 6</span>.</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md210"></a>
Implementation Notes</h2>
<ul>
<li>Tokenizer responsibilities:<ul>
<li>Recognize numeric-parameter escapes and split tag name / parameter string.</li>
<li>Validate numeric parameters (digits, optional separators) before calling std::stoi to avoid exceptions.</li>
<li>Maintain per-field stacks (or a FontStyle snapshot stack) to support nested tags and proper restoration on close.</li>
<li>Record escape tokens with the style state <em>before</em> applying the tag action (current tokenizer semantic). Word tokens are recorded with the style state after applying the action.</li>
</ul>
</li>
<li>Defaults and documentation:<ul>
<li>Ensure header defaults in <span class="tt"><a class="el" href="SDOM__IFontObject_8hpp.html">SDOM_IFontObject.hpp</a></span> and doc defaults match (synchronize default values in docs and headers).</li>
</ul>
</li>
<li>Lua bindings / testing:<ul>
<li><span class="tt">DisplayHandle:getTokenList()</span> returns tokens where <span class="tt">token.style</span> includes numeric fields named exactly as in <span class="tt">FontStyle</span>.</li>
<li>Add unit tests (Label_test5) that create labels containing the numeric escapes, call <span class="tt">tokenizeText()</span>, then assert the expected numeric values are present on the word tokens inside the tags.</li>
</ul>
</li>
<li>Error handling:<ul>
<li>On malformed numeric params, avoid throwing — log or ignore and continue. Tests should assert presence of values only when syntactically valid parameters are used.</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md211"></a>
Test seed suggestion (Label_test5)</h2>
<div class="fragment"><div class="line">local txt = &quot;Start [border=3]B1[/border] [outline=2]O1[/outline] [pad=5x7]P1[/pad] [dropshadow=4,6]DS1[/dropshadow] End&quot;</div>
</div><!-- fragment --><ul>
<li>After <span class="tt">h:setText(txt)</span> and <span class="tt">h:tokenizeText()</span>, verify that the relevant word tokens expose:<ul>
<li><span class="tt">style.borderThickness == 3</span></li>
<li><span class="tt">style.outlineThickness == 2</span></li>
<li><span class="tt">style.padding_horiz == 5</span> and <span class="tt">style.padding_vert == 7</span></li>
<li><span class="tt">style.dropshadowOffsetX == 4</span> and <span class="tt">style.dropshadowOffsetY == 6</span></li>
</ul>
</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md213"></a>
Token Structure</h1>
<p>Each parsed token represents either a word or an escape sequence:</p>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> TokenType { <a class="code hl_define" href="SDOM__CLR_8hpp.html#abf4ef44c4c8719bd6d059ca8cdbe0fde">Word</a>, Escape };</div>
<div class="line"><span class="keyword">struct </span>LabelToken {</div>
<div class="line">    TokenType type;</div>
<div class="line">    std::string text;      <span class="comment">// For words</span></div>
<div class="line">    std::string escape;    <span class="comment">// For escape sequences</span></div>
<div class="line">    LabelStyle style;      <span class="comment">// Style at this token</span></div>
<div class="line">};</div>
<div class="ttc" id="aSDOM__CLR_8hpp_html_abf4ef44c4c8719bd6d059ca8cdbe0fde"><div class="ttname"><a href="SDOM__CLR_8hpp.html#abf4ef44c4c8719bd6d059ca8cdbe0fde">Word</a></div><div class="ttdeci">#define Word</div><div class="ttdef"><b>Definition</b> SDOM_CLR.hpp:46</div></div>
</div><!-- fragment --><p><b>Word tokens</b>: Actual text to render, with associated style and alignment. <b>Escape tokens</b>: Instructions to change style, color, alignment, etc.</p>
<p><b>Token Types:</b></p><ul>
<li>Word: Plain text, whitespace, punctuation</li>
<li>Escape: Style change, color, font, alignment</li>
<li>Bracket Escape: Literal '[' or ']'</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md214"></a>
Word Tokenization Rules</h2>
<ul>
<li>Quoted text (enclosed in double quotes) is tokenized as word tokens, but spaces and punctuation within the quoted text are still tokenized as individual word tokens (not grouped).</li>
<li>Escape sequences occurring within a double-quote block are treated as word tokens, not escape tokens.</li>
<li>To render a literal double quote character, use the escape sequence <span class="tt">["].&lt;/tt&gt;
- Single quotes are always tokenized as punctuation or as part of a word (e.g., apostrophes).
@subsubsection autotoc_md215 Example tokenization:
Input: 
@icode 
"Hello, [b]world!" 'test' ["]
 
Output: 
<div class="fragment"><div class="line">&quot;</div>
<div class="line">Hello</div>
<div class="line">,</div>
<div class="line">[b]</div>
<div class="line">world</div>
<div class="line">!</div>
<div class="line">&quot;</div>
<div class="line">&#39;</div>
<div class="line">test</div>
<div class="line">&#39;</div>
<div class="line">&quot;</div>
</div><!-- fragment --><ul>
<li>Word tokens are sequences of characters not part of escape sequences or bracket escapes.</li>
<li>Token boundaries are defined by:<ul>
<li>Whitespace (space, tab, newline)</li>
<li>Escape sequence start (<span class="tt">[</span>)</li>
<li>Bracket escapes (<span class="tt">[[]</span>, <span class="tt">[]]</span>)</li>
</ul>
</li>
</ul>
</span></li>
<li><span class="tt">Punctuation marks (e.g., <span class="tt">.</span>, <span class="tt">,</span>, <span class="tt">!</span>, <span class="tt">?</span>) are each treated as their own word token.</span></li>
<li><span class="tt">Spaces are each treated as their own token (one space-per-token), allowing for adjustable space width.</span></li>
<li><span class="tt">Tabs (<span class="tt">\t</span>) are treated as their own token.</span></li>
<li><span class="tt">Newlines (<span class="tt">\n</span>) are treated as their own token.</span></li>
<li><span class="tt">Words are sequences of non-whitespace, non-punctuation, non-escape, and non-bracket characters.</span></li>
<li><p class="startli"><span class="tt">Example tokenization:</p><ul>
<li>Input: <span class="tt">Hello,  [b]world[[]]![]]\t\n</span></li>
<li>Tokens: <span class="tt">Hello</span>, <span class="tt">,</span>, <span class="tt"> </span>, <span class="tt"> </span>, <span class="tt">[b]</span>, <span class="tt">world</span>, <span class="tt">[[]]</span>, <span class="tt">!</span>, <span class="tt">[]]</span>, <span class="tt">\t</span>, <span class="tt">\n</span></li>
</ul>
<p></span></p>
<p class="startli"><span class="tt"> <b>Special Cases:</b></p><ul>
<li>Bracket escapes (<span class="tt">[[]</span>, <span class="tt">[]]</span>) are treated as single tokens, not split into word/escape.</li>
<li>Escape sequences (e.g., <span class="tt">[b]</span>, <span class="tt">[color=red]</span>) are not part of word tokens.</li>
</ul>
<p></span></p>
</li>
<li><span class="tt"><b>Escape tokens</b>: Instructions to change style, color, alignment, etc.</span></li>
</ul>
<p><span class="tt"></span></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md216"></a>
<span class="tt">Escape Tokenization Rules</span></h2>
<p><span class="tt"></span></p>
<p><span class="tt"></p><ul>
<li>Escape tokens are recognized as pairs of square brackets (e.g., <span class="tt">[b]</span>, <span class="tt">[color=red]</span>, <span class="tt">[reset]</span>) that are not within an enclosing double-quote block.</li>
<li>Any sequence starting with <span class="tt">[</span> and ending with <span class="tt">]</span> outside of double quotes is treated as an escape token.</li>
<li>Escape tokens inside double quotes are treated as word tokens, not escape tokens.</li>
<li>Bracket escapes (<span class="tt">[[]</span>, <span class="tt">[]]</span>) are not treated as escape tokens, but as word tokens representing literal brackets.</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md218"></a>
<span class="tt">Parsing Algorithm</span></h1>
<p><span class="tt"></p><ol type="1">
<li><b>Initialize</b> default <span class="tt">LabelStyle</span>.</li>
<li><b>Scan input string</b>:<ul>
<li>When an escape sequence is encountered, parse and update the current <span class="tt">LabelStyle</span>.</li>
<li>When a word is encountered, create a token with the current style and alignment.</li>
</ul>
</li>
<li><b>Store tokens</b> in a list for further processing.</li>
</ol>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md220"></a>
<span class="tt">Alignment Handling</span></h1>
<p><span class="tt"></p><ul>
<li>Each word token carries its own alignment (horizontal and vertical) from <span class="tt">LabelStyle</span>.</li>
<li>For rendering, tokens are sorted into nine groups based on alignment:<ul>
<li>LEFT+TOP, LEFT+MIDDLE, LEFT+BOTTOM</li>
<li>CENTER+TOP, CENTER+MIDDLE, CENTER+BOTTOM</li>
<li>RIGHT+TOP, RIGHT+MIDDLE, RIGHT+BOTTOM</li>
</ul>
</li>
<li>Each group is rendered according to its alignment rules.</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md222"></a>
<span class="tt">Word Wrapping &amp; Autosizing</span></h1>
<p><span class="tt"></p><ul>
<li>Measure each word using font metrics.</li>
<li>Accumulate words into lines, wrapping when the line width exceeds label bounds (minus padding).</li>
<li>If <span class="tt">auto_width</span> or <span class="tt">auto_height</span> is enabled, adjust label bounds to fit content.</li>
<li>If not, clip content to label bounds.</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md224"></a>
<span class="tt">Rendering</span></h1>
<p><span class="tt"></p><ul>
<li>For each line and token:<ul>
<li>Apply the token's style and alignment.</li>
<li>Render the word using the associated font and style.</li>
<li>Skip rendering for escape tokens.</li>
</ul>
</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md226"></a>
<span class="tt">Extensibility</span></h1>
<p><span class="tt"></p><ul>
<li>New escape sequences can be added for additional styles (e.g., outline, dropshadow).</li>
<li>The tokenization and rendering logic is modular, allowing future expansion (e.g., hyperlinks, images).</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md228"></a>
<span class="tt">Example</span></h1>
<p><span class="tt">
</p><div class="fragment"><div class="line">[bold][color=#00FF00]Score:[reset] 100 [align=right][color=#FF0000]Game Over</div>
</div><!-- fragment --><ul>
<li>"Score:" is bold and green.</li>
<li>"100" is default style.</li>
<li>"Game Over" is right-aligned and red.</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md230"></a>
<span class="tt">Implementation Notes</span></h1>
<p><span class="tt"></span></p>
<p><span class="tt"></span></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md231"></a>
<span class="tt">Label Sizing and Wrapping Rules</span></h2>
<p><span class="tt"></span></p>
<p><span class="tt"></p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">wordwrap  </th><th class="markdownTableHeadNone">auto_width  </th><th class="markdownTableHeadNone">auto_height  </th><th class="markdownTableHeadNone">clip_to_parent  </th><th class="markdownTableHeadNone">Behavior  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Single line, fixed size, overflow is clipped at label bounds.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Single line, label expands width to fit text, height fixed.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Single line, width fixed, label expands height (rare, but possible).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Single line, label expands both width and height to fit text.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Multi-line, fixed size, overflow is clipped at label bounds.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Multi-line, label expands width to fit longest wrapped line, height fixed. Max width is clamped to the minimum of a user-specified value (if set) and the parent's right edge.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">false  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Multi-line, width fixed, label expands height to fit all lines.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">true  </td><td class="markdownTableBodyNone">any  </td><td class="markdownTableBodyNone">Multi-line, label expands both width and height to fit all text.  </td></tr>
</table>
<p></span></p>
<p><span class="tt"><b>Note:</b>
For both axes, the maximum auto_width/auto_height should be clamped to the minimum of a user-specified maximum (if provided) and the label's parent's bounds. This ensures the label never exceeds its parent's area or a user-imposed limit.</span></p>
<p><span class="tt"></p><ul>
<li>If <span class="tt">clip_to_parent</span> is true, always clip rendering to parent’s bounds, regardless of label size.</li>
</ul>
<p></span></p>
<p><span class="tt"></span></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md232"></a>
<span class="tt">Implementation Notes</span></h2>
<p><span class="tt"></p><ul>
<li>When <span class="tt">auto_width</span> or <span class="tt">auto_height</span> is true, recalculate the label’s size after tokenizing/layout.</li>
<li>When <span class="tt">clip_to_parent</span> is true, use SDL’s clipping/scissor rect to restrict rendering.</li>
<li>Always document these behaviors for other developers.</li>
</ul>
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md233"></a>
<span class="tt">Rendering Phases (Functions):</span></h1>
<p><span class="tt">
</span></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md234"></a>
<span class="tt">1. Pre-Render Layout &amp; Bounds Adjustment</span></h2>
<p><span class="tt"></p><ul>
<li><b>Purpose:</b> Calculate the final size and position of the label before rendering.</li>
<li><b>Actions:</b><ul>
<li>Use tokenizeText() to break the text into tokens.</li>
<li>Measure the required width/height based on tokens, wordwrap, and style.
  -If auto_width/auto_height is enabled, adjust the label’s bounds.</li>
<li>If clip_to_parent or similar is enabled, set up the SDL clip/scissor region to the label or parent bounds.
</li>
</ul>
</li>
</ul>
<p></span></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md235"></a>
<span class="tt">2. Phrase Grouping</span></h2>
<p><span class="tt"></p><ul>
<li><b>Purpose:</b> Group tokens into “phrases” (runs of tokens with identical rendering attributes and on the same line).- <b>Actions:</b><ul>
<li>Iterate through each alignment list.</li>
<li>For each line, group consecutive tokens with the same <span class="tt">FontStyle</span> (or at least the same visual attributes).</li>
<li>Store these as <span class="tt">PhraseToken</span> objects: <span class="tt">{startX, text, style, lineY, ...}</span> in a new map, e.g. <span class="tt">std::map&lt;AlignQueue, std::vector&lt;PhraseToken&gt;&gt; phraseAlignLists_;</span> </li>
</ul>
</li>
</ul>
<p></span></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md236"></a>
<span class="tt">3. Phrase Rendering</span></h2>
<p><span class="tt"></p><ul>
<li><b>Purpose:</b> Render each phrase efficiently and with correct visual effects.</li>
<li><b>Actions:</b><ul>
<li>For each phrase in order:<ul>
<li>If TTF: Use <span class="tt">TTF_RenderText_Blended()</span> for the phrase.</li>
<li><span class="tt">BitmapFont</span>: This should also render text in phrase groups adding display attributes like TruetypeFont does.</li>
<li>Apply all style effects (underline, strikethrough, outline, dropshadow, etc.) at the phrase level.</li>
<li>Render backgrounds, borders, etc., as needed.</li>
</ul>
</li>
<li>Restore the previous SDL clip region if it was changed.</li>
</ul>
</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"></span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md238"></a>
<span class="tt">References</span></h1>
<p><span class="tt"></p><ul>
<li>SDOM2 <span class="tt">Label</span> class</li>
<li><span class="tt">LabelStyle</span> and <span class="tt">FontStyle</span> structs</li>
<li>SDL2/SDL3 rendering best practices</li>
</ul>
<p></span></p>
<p><span class="tt"></p><hr  />
<p></span></p>
<p><span class="tt"><em>This document will be updated as the implementation progresses.</em>
</span></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<footer>
  <a href="#top">Back to top</a> &nbsp;|&nbsp; <a href="https://github.com/warte67/SDOM">Back to SDOM on GitHub</a>
</footer>
